<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Rinc√≥n del Barril - v10</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:Segoe UI,sans-serif;background:linear-gradient(135deg,#8B0000,#C41E3A);min-height:100vh;padding:10px}.container{max-width:700px;margin:0 auto}.header{background:#fff;border-radius:15px 15px 0 0;padding:15px;text-align:center;border-bottom:3px solid #8B0000}.header h1{color:#8B0000;font-size:20px;margin-bottom:5px}.user-section{display:flex;justify-content:space-between;align-items:center;padding:10px;background:#f0f0f0;border-radius:6px;font-size:11px;margin-top:10px;gap:8px;flex-wrap:wrap}.user-badge{background:#8B0000;color:#fff;padding:4px 10px;border-radius:15px;font-weight:600;cursor:pointer}.status-badge{background:#4CAF50;color:#fff;padding:4px 10px;border-radius:15px;font-weight:600;font-size:10px}.btn-sync{background:#2196F3;color:#fff;padding:4px 10px;border-radius:4px;border:none;cursor:pointer;font-size:10px;font-weight:600}.tabs{display:flex;background:#fff;padding:0 10px;border-bottom:1px solid #DDD;overflow-x:auto;flex-wrap:wrap}.tab-btn{flex:1;padding:10px 6px;background:none;border:none;cursor:pointer;font-weight:600;color:#999;border-bottom:3px solid transparent;font-size:9px;min-width:35px;white-space:nowrap}.tab-btn.active{color:#8B0000;border-bottom-color:#8B0000}.content{background:#fff;padding:15px;border-radius:0 0 15px 15px;min-height:600px;max-height:80vh;overflow-y:auto}.tab-content{display:none}.tab-content.active{display:block}.search-box{width:100%;padding:10px;margin-bottom:15px;border:1px solid #DDD;border-radius:6px;font-size:13px}.filter-buttons{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:15px}.filter-btn{padding:6px 10px;border:1px solid #DDD;background:#fff;border-radius:15px;cursor:pointer;font-size:11px;font-weight:600;color:#666}.filter-btn.active{background:#8B0000;color:#fff;border-color:#8B0000}.form-group{margin-bottom:12px}.form-group label{display:block;font-size:11px;font-weight:600;margin-bottom:4px;color:#333}.form-group input,.form-group select{width:100%;padding:8px;border:1px solid #DDD;border-radius:4px;font-size:12px;font-family:inherit}.form-row{display:grid;grid-template-columns:1fr 1fr;gap:8px}.btn{padding:8px 12px;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:12px;width:100%}.btn-primary{background:#8B0000;color:#fff}.btn-secondary{background:#f0f0f0;color:#333;border:1px solid #DDD}.btn-small{background:#f44336;color:#fff;padding:4px 8px;font-size:10px;border:none;border-radius:3px;cursor:pointer}.product-card{background:#f9f9f9;border:1px solid #EEE;border-radius:6px;padding:10px;margin-bottom:8px;display:flex;justify-content:space-between}.product-info{flex:1}.product-name{font-weight:600;font-size:12px}.product-category{font-size:10px;color:#999;margin-top:2px}.product-stock{font-size:13px;font-weight:600;color:#8B0000;text-align:right}.alert{padding:10px;border-radius:6px;margin-bottom:15px;font-size:12px;font-weight:600}.alert.success{background:#E8F5E9;color:#2E7D32}.alert.error{background:#FFEBEE;color:#C62828}.list-item{background:#f9f9f9;padding:8px;margin-bottom:6px;border-radius:4px;font-size:11px;border-left:3px solid #8B0000}.scroll{max-height:300px;overflow-y:auto}h3{color:#8B0000;font-size:12px;margin-bottom:10px;border-bottom:2px solid #8B0000;padding-bottom:8px}.admin-item{background:#f9f9f9;padding:8px;margin-bottom:6px;border-radius:4px;display:flex;justify-content:space-between;align-items:center;font-size:11px}textarea{width:100%;padding:8px;border:1px solid #DDD;border-radius:4px;font-size:12px;font-family:monospace;min-height:80px}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçñ El Rinc√≥n del Barril</h1>
            <p>Gesti√≥n de Inventario v10</p>
            <div class="user-section">
                <div><span class="user-badge" onclick="cambiarUsuario()">üë§ <span id="user">Bodega</span></span></div>
                <div><span class="status-badge">‚úÖ Mov: <span id="mov">0</span></span></div>
                <button class="btn-sync" onclick="descargar()">üì•</button>
                <button class="btn-sync" onclick="cargar()">üì§</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="tab('saldos')">üìä</button>
            <button class="tab-btn" onclick="tab('entradas')">üì•</button>
            <button class="tab-btn" onclick="tab('salidas')">üì§</button>
            <button class="tab-btn" onclick="tab('reportes')">üìà</button>
            <button class="tab-btn" onclick="tab('admin')">‚öôÔ∏è</button>
        </div>

        <div class="content">
            <div id="alerta"></div>

            <!-- SALDOS -->
            <div id="saldos" class="tab-content active">
                <input type="text" class="search-box" placeholder="üîç Buscar..." oninput="buscar(this.value)">
                <h3>Filtros</h3>
                <div class="filter-buttons" id="filtros"></div>
                <div id="lista-saldos"></div>
            </div>

            <!-- ENTRADAS -->
            <div id="entradas" class="tab-content">
                <h3>Registrar Entrada</h3>
                <div class="form-group"><label>Responsable</label><select id="resp-ent"></select></div>
                <div class="form-group"><label>Proveedor</label><select id="prov-ent"></select></div>
                <div class="form-group"><label>Producto</label><select id="prod-ent"></select></div>
                <div class="form-row">
                    <div class="form-group"><label>Cantidad</label><input type="number" id="cant-ent" step="0.01"></div>
                    <div class="form-group"><label>Costo</label><input type="number" id="cost-ent" step="0.01"></div>
                </div>
                <button class="btn btn-primary" onclick="entrar()">‚úÖ Registrar</button>
                <h3 style="margin-top:15px">√öltimas</h3>
                <div class="scroll" id="ultimas-ent"></div>
            </div>

            <!-- SALIDAS -->
            <div id="salidas" class="tab-content">
                <h3>Registrar Salida</h3>
                <div class="form-group"><label>Responsable</label><select id="resp-sal"></select></div>
                <div class="form-group"><label>Destino</label><select id="dest-sal"><option>-- Selecciona --</option><option>üë®‚Äçüç≥ Cocina</option><option>üí∞ Caja</option><option>üçñ Barril</option><option>ü•ò Consumo</option><option>üìâ Merma</option><option>üî• Da√±o</option></select></div>
                <div class="form-group"><label>Producto</label><select id="prod-sal"></select></div>
                <div class="form-group"><label>Cantidad</label><input type="number" id="cant-sal" step="0.01"></div>
                <button class="btn btn-primary" onclick="salir()">‚úÖ Registrar</button>
                <h3 style="margin-top:15px">√öltimas</h3>
                <div class="scroll" id="ultimas-sal"></div>
            </div>

            <!-- REPORTES -->
            <div id="reportes" class="tab-content">
                <h3>Movimientos de Hoy</h3>
                <div class="scroll" id="hoy"></div>
            </div>

            <!-- ADMIN -->
            <div id="admin" class="tab-content">
                <h3>Responsables</h3>
                <div class="form-row" style="margin-bottom:10px"><input type="text" id="new-resp" placeholder="Nombre"><button class="btn btn-primary" onclick="addResp()">‚úÖ</button></div>
                <div id="lista-resp"></div>

                <h3>Proveedores</h3>
                <div class="form-row" style="margin-bottom:10px"><input type="text" id="new-prov" placeholder="Nombre"><button class="btn btn-primary" onclick="addProv()">‚úÖ</button></div>
                <div id="lista-prov"></div>

                <h3>Categor√≠as</h3>
                <div class="form-row" style="margin-bottom:10px"><input type="text" id="new-cat" placeholder="Ej: üçñ Prote√≠nas"><button class="btn btn-primary" onclick="addCat()">‚úÖ</button></div>
                <div id="lista-cat"></div>

                <h3>Productos</h3>
                <div class="form-group"><label>Nombre</label><input type="text" id="new-prod-name"></div>
                <div class="form-group"><label>Categor√≠a</label><select id="new-prod-cat"></select></div>
                <div class="form-group"><label>M√≠nimo</label><input type="number" id="new-prod-min" min="0" step="0.01"></div>
                <button class="btn btn-primary" onclick="addProd()">‚úÖ Agregar</button>
                <div id="lista-prod"></div>

                <h3>Datos</h3>
                <button class="btn btn-secondary" onclick="descargar()" style="margin-bottom:10px">üì• Descargar JSON</button>
                <textarea id="json-txt" placeholder="O pega JSON aqu√≠..."></textarea>
                <button class="btn btn-primary" style="margin-top:10px" onclick="cargarJSON()">üì§ Cargar JSON</button>
            </div>
        </div>
    </div>

    <script>
        let resp = ['Bodega', 'Cocinero', 'Cajero', 'Gerente'];
        let prov = ['Atlantic', 'mis tres amores', 'Carnes xyz', 'Distribuidora Local'];
        let cat = ['üçñ Prote√≠nas', 'üßÄ L√°cteos', '‚ùÑÔ∏è Congelados', 'üåæ Secos', 'ü•¨ Verduras'];
        let prod = [
            {id:1, n:'Costilla de cerdo', c:'üçñ Prote√≠nas', cr:3.95, co:0, u:'kg', min:5},
            {id:2, n:'Pollo', c:'üçñ Prote√≠nas', cr:16, co:0, u:'kg', min:7},
            {id:3, n:'Queso paisa', c:'üßÄ L√°cteos', cr:0.52, co:0, u:'kg', min:1},
            {id:4, n:'Papa', c:'‚ùÑÔ∏è Congelados', cr:12.5, co:0, u:'kg', min:10},
            {id:5, n:'Chicharr√≥n', c:'üçñ Prote√≠nas', cr:7.7, co:0, u:'kg', min:7},
            {id:6, n:'Lomo de cerdo', c:'üçñ Prote√≠nas', cr:9.71, co:0, u:'kg', min:4},
            {id:7, n:'Punta de anca', c:'üçñ Prote√≠nas', cr:3.04, co:0, u:'kg', min:2},
            {id:8, n:'Carne molida CAB', c:'üçñ Prote√≠nas', cr:17.47, co:0, u:'kg', min:0},
            {id:9, n:'Carne molida regular', c:'üçñ Prote√≠nas', cr:24.6, co:0, u:'kg', min:4},
            {id:10, n:'Croquetas de carne', c:'üçñ Prote√≠nas', cr:74, co:0, u:'kg', min:70},
            {id:11, n:'Pecho de res', c:'üçñ Prote√≠nas', cr:0, co:0, u:'kg', min:0},
            {id:12, n:'Contramuslo de pollo', c:'üçñ Prote√≠nas', cr:0, co:0, u:'kg', min:0},
            {id:13, n:'Colita de cadera', c:'üçñ Prote√≠nas', cr:0, co:0, u:'kg', min:3},
            {id:14, n:'Morcilla', c:'üçñ Prote√≠nas', cr:1.84, co:0, u:'kg', min:0},
            {id:15, n:'Chorizo', c:'üçñ Prote√≠nas', cr:1.27, co:0, u:'kg', min:5},
            {id:16, n:'Queso cheddar', c:'üßÄ L√°cteos', cr:207, co:0, u:'kg', min:80},
            {id:17, n:'Tocineta', c:'üçñ Prote√≠nas', cr:7.6, co:0, u:'kg', min:3},
            {id:18, n:'Salchichas', c:'üçñ Prote√≠nas', cr:19, co:0, u:'kg', min:15},
            {id:19, n:'Pan brioche de hamburguesa', c:'üåæ Secos', cr:46, co:0, u:'kg', min:30},
            {id:20, n:'Pan brioche de perro', c:'üåæ Secos', cr:13, co:0, u:'kg', min:10},
            {id:21, n:'Papa pastusa', c:'ü•¨ Verduras', cr:14, co:0, u:'kg', min:4},
            {id:22, n:'Cebolla cabezona', c:'ü•¨ Verduras', cr:18, co:0, u:'kg', min:10},
            {id:23, n:'Tomate', c:'ü•¨ Verduras', cr:12, co:0, u:'kg', min:5},
            {id:24, n:'Panela', c:'üåæ Secos', cr:10, co:0, u:'kg', min:5},
            {id:25, n:'Mayonesa Natucampo', c:'üåæ Secos', cr:5, co:0, u:'kg', min:2},
            {id:26, n:'Arroz Zulia', c:'üåæ Secos', cr:3, co:0, u:'kg', min:2},
            {id:27, n:'Frijol Bol√≥n Rojo', c:'üåæ Secos', cr:1, co:0, u:'kg', min:1},
            {id:28, n:'Aceite Sinai', c:'üåæ Secos', cr:2, co:0, u:'kg', min:1}
        ];
        let mov = [];
        let user = 'Bodega';
        let filtro = 'todos';
        let id = 5;

        function init() {
            const d = localStorage.getItem('inv');
            if (d) {
                const x = JSON.parse(d);
                resp = x.resp || resp;
                prov = x.prov || prov;
                cat = x.cat || cat;
                prod = x.prod || prod;
                mov = x.mov || [];
                user = x.user || 'Bodega';
                id = x.id || 5;
            }
            actualizar();
            alerta('‚úÖ Listo', 'success');
        }

        function save() {
            localStorage.setItem('inv', JSON.stringify({resp, prov, cat, prod, mov, user, id}));
        }

        function actualizar() {
            document.getElementById('user').textContent = user;
            
            const opts = resp.map(r => `<option>${r}</option>`).join('');
            const opts2 = prov.map(p => `<option>${p}</option>`).join('');
            const opts3 = prod.map(p => `<option value="${p.id}">${p.n}</option>`).join('');
            const opts4 = cat.map(c => `<option>${c}</option>`).join('');
            
            ['resp-ent', 'resp-sal'].forEach(e => document.getElementById(e).innerHTML = '<option>--</option>' + opts);
            document.getElementById('prov-ent').innerHTML = '<option>--</option>' + opts2;
            ['prod-ent', 'prod-sal'].innerHTML = '<option>--</option>' + opts3;
            document.getElementById('new-prod-cat').innerHTML = '<option>--</option>' + opts4;
            
            document.getElementById('filtros').innerHTML = '<button class="filter-btn active" onclick="filtro2(\'todos\')">Todos</button>' + 
                [...new Set(prod.map(p => p.c))].sort().map(c => `<button class="filter-btn" onclick="filtro2('${c}')">${c}</button>`).join('');
            
            saldos();
            entradas();
            salidas();
            reportes();
            admin();
            conteo();
        }

        function saldos() {
            const ps = filtro === 'todos' ? prod : prod.filter(p => p.c === filtro);
            document.getElementById('lista-saldos').innerHTML = ps.length === 0 ? '<p style="color:#999">Sin productos</p>' : 
                ps.map(p => {
                    const t = p.cr + p.co;
                    const bg = t < p.min ? ' style="background:#FFEBEE"' : '';
                    return `<div class="product-card"${bg}><div class="product-info"><div class="product-name">${p.n}</div><div class="product-category">${p.c}</div><div style="font-size:10px;color:#666;margin-top:4px">${p.c.includes('Prote√≠na') ? `üîµ ${p.cr.toFixed(2)} | üî¥ ${p.co.toFixed(2)}` : `Total: ${t.toFixed(2)}`}</div></div><div class="product-stock">${t.toFixed(2)}</div></div>`;
                }).join('');
        }

        function entradas() {
            const ultimas = mov.filter(m => m.t === 'ent').slice(-10).reverse();
            document.getElementById('ultimas-ent').innerHTML = ultimas.length === 0 ? '<p style="color:#999">Sin entradas</p>' : 
                ultimas.map(m => `<div class="list-item"><b>${m.p}</b><br>${m.c1 > 0 ? m.c1.toFixed(2) + ' crudo | ' : ''}${m.c2 > 0 ? m.c2.toFixed(2) + ' cocido | ' : ''}${m.prov} | $${m.costo}</div>`).join('');
        }

        function salidas() {
            const ultimas = mov.filter(m => m.t === 'sal').slice(-10).reverse();
            document.getElementById('ultimas-sal').innerHTML = ultimas.length === 0 ? '<p style="color:#999">Sin salidas</p>' : 
                ultimas.map(m => `<div class="list-item"><b>${m.p}</b><br>${m.c1 > 0 ? m.c1.toFixed(2) + ' crudo' : ''}${m.c2 > 0 ? ' / ' + m.c2.toFixed(2) + ' cocido' : ''} | ${m.resp}</div>`).join('');
        }

        function reportes() {
            const hoy = new Date().toISOString().split('T')[0];
            const hoyMov = mov.filter(m => m.f === hoy);
            document.getElementById('hoy').innerHTML = hoyMov.length === 0 ? '<p style="color:#999">Sin movimientos</p>' : 
                hoyMov.map(m => {
                    const icon = m.t === 'ent' ? 'üì•' : 'üì§';
                    return `<div class="list-item"><b>${icon} ${m.h} - ${m.p}</b><br>${m.c1 > 0 ? m.c1.toFixed(2) + ' crudo' : ''}${m.c2 > 0 ? ' / ' + m.c2.toFixed(2) + ' cocido' : ''} | ${m.resp}</div>`;
                }).join('');
        }

        function admin() {
            document.getElementById('lista-resp').innerHTML = resp.map(r => `<div class="admin-item"><span>${r}</span><button class="btn-small" onclick="delResp('${r}')">‚ùå</button></div>`).join('');
            document.getElementById('lista-prov').innerHTML = prov.map(p => `<div class="admin-item"><span>${p}</span><button class="btn-small" onclick="delProv('${p}')">‚ùå</button></div>`).join('');
            document.getElementById('lista-cat').innerHTML = cat.map(c => `<div class="admin-item"><span>${c}</span><button class="btn-small" onclick="delCat('${c}')">‚ùå</button></div>`).join('');
            document.getElementById('lista-prod').innerHTML = prod.map(p => `<div class="admin-item"><span>${p.n} (${(p.cr+p.co).toFixed(2)})</span><button class="btn-small" onclick="delProd(${p.id})">‚ùå</button></div>`).join('');
        }

        function conteo() {
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('mov').textContent = mov.filter(m => m.f === hoy).length;
        }

        function tab(name) {
            document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(e => e.classList.remove('active'));
            document.getElementById(name).classList.add('active');
            event.target.classList.add('active');
        }

        function cambiarUsuario() {
            const idx = prompt(`Selecciona:\n${resp.map((r,i) => (i+1) + '. ' + r).join('\n')}`);
            if (idx && resp[parseInt(idx)-1]) {
                user = resp[parseInt(idx)-1];
                save();
                document.getElementById('user').textContent = user;
            }
        }

        function buscar(t) {
            const ps = filtro === 'todos' ? prod : prod.filter(p => p.c === filtro);
            const res = ps.filter(p => p.n.toLowerCase().includes(t.toLowerCase()));
            document.getElementById('lista-saldos').innerHTML = res.length === 0 ? '<p style="color:#999">Sin productos</p>' : 
                res.map(p => {
                    const total = p.cr + p.co;
                    return `<div class="product-card"><div class="product-info"><div class="product-name">${p.n}</div></div><div class="product-stock">${total.toFixed(2)}</div></div>`;
                }).join('');
        }

        function filtro2(f) {
            filtro = f;
            document.querySelectorAll('.filter-btn').forEach(e => e.classList.remove('active'));
            event.target.classList.add('active');
            saldos();
        }

        function entrar() {
            const r = document.getElementById('resp-ent').value;
            const p = document.getElementById('prov-ent').value;
            const pid = parseInt(document.getElementById('prod-ent').value);
            const c = parseFloat(document.getElementById('cant-ent').value);
            const costo = parseFloat(document.getElementById('cost-ent').value);

            if (!r || !p || !pid || isNaN(c) || isNaN(costo)) { alerta('‚ö†Ô∏è Completa campos', 'error'); return; }

            const product = prod.find(x => x.id === pid);
            product.cr += c;

            mov.push({
                f: new Date().toISOString().split('T')[0],
                h: new Date().toTimeString().slice(0,5),
                t: 'ent',
                c1: c,
                c2: 0,
                p: product.n,
                resp: r,
                costo: costo,
                prov: p
            });

            save();
            alerta('‚úÖ Entrada registrada', 'success');
            document.getElementById('resp-ent').value = '';
            document.getElementById('prov-ent').value = '';
            document.getElementById('prod-ent').value = '';
            document.getElementById('cant-ent').value = '';
            document.getElementById('cost-ent').value = '';
            actualizar();
        }

        function salir() {
            const r = document.getElementById('resp-sal').value;
            const d = document.getElementById('dest-sal').value;
            const pid = parseInt(document.getElementById('prod-sal').value);
            const c = parseFloat(document.getElementById('cant-sal').value);

            if (!r || !d || !pid || isNaN(c)) { alerta('‚ö†Ô∏è Completa campos', 'error'); return; }

            const product = prod.find(x => x.id === pid);
            const dis = product.cr + product.co;

            if (c > dis) { alerta(`‚ö†Ô∏è Stock insuficiente: ${dis.toFixed(2)}`, 'error'); return; }

            product.cr -= c;

            mov.push({
                f: new Date().toISOString().split('T')[0],
                h: new Date().toTimeString().slice(0,5),
                t: 'sal',
                c1: c,
                c2: 0,
                p: product.n,
                resp: r,
                dest: d,
                costo: 0,
                prov: ''
            });

            save();
            alerta('‚úÖ Salida registrada', 'success');
            document.getElementById('resp-sal').value = '';
            document.getElementById('dest-sal').value = '';
            document.getElementById('prod-sal').value = '';
            document.getElementById('cant-sal').value = '';
            actualizar();
        }

        function addResp() {
            const n = document.getElementById('new-resp').value.trim();
            if (!n || resp.includes(n)) { alerta('‚ùå Error', 'error'); return; }
            resp.push(n);
            save();
            document.getElementById('new-resp').value = '';
            actualizar();
            alerta('‚úÖ Agregado', 'success');
        }

        function addProv() {
            const n = document.getElementById('new-prov').value.trim();
            if (!n || prov.includes(n)) { alerta('‚ùå Error', 'error'); return; }
            prov.push(n);
            save();
            document.getElementById('new-prov').value = '';
            actualizar();
            alerta('‚úÖ Agregado', 'success');
        }

        function addCat() {
            const n = document.getElementById('new-cat').value.trim();
            if (!n || cat.includes(n)) { alerta('‚ùå Error', 'error'); return; }
            cat.push(n);
            save();
            document.getElementById('new-cat').value = '';
            actualizar();
            alerta('‚úÖ Agregado', 'success');
        }

        function addProd() {
            const n = document.getElementById('new-prod-name').value.trim();
            const c = document.getElementById('new-prod-cat').value;
            const m = parseFloat(document.getElementById('new-prod-min').value) || 0;
            if (!n || !c) { alerta('‚ö†Ô∏è Completa', 'error'); return; }
            prod.push({id: id++, n, c, cr: 0, co: 0, u: 'kg', min: m});
            save();
            document.getElementById('new-prod-name').value = '';
            document.getElementById('new-prod-min').value = '';
            actualizar();
            alerta('‚úÖ Producto agregado', 'success');
        }

        function delResp(r) { if (confirm(`¬øEliminar "${r}"?`)) { resp = resp.filter(x => x !== r); save(); actualizar(); } }
        function delProv(p) { if (confirm(`¬øEliminar "${p}"?`)) { prov = prov.filter(x => x !== p); save(); actualizar(); } }
        function delCat(c) { if (confirm(`¬øEliminar "${c}"?`)) { cat = cat.filter(x => x !== c); prod = prod.filter(p => p.c !== c); save(); actualizar(); } }
        function delProd(pid) { if (confirm('¬øEliminar?')) { prod = prod.filter(p => p.id !== pid); save(); actualizar(); } }

        function descargar() {
            const json = JSON.stringify({resp, prov, cat, prod, mov, user, id}, null, 2);
            const blob = new Blob([json], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `inv_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            alerta('‚úÖ Descargado', 'success');
        }

        function cargar() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (ev) => {
                    try {
                        const x = JSON.parse(ev.target.result);
                        resp = x.resp; prov = x.prov; cat = x.cat; prod = x.prod; mov = x.mov; user = x.user; id = x.id;
                        save();
                        actualizar();
                        alerta('‚úÖ Cargado', 'success');
                    } catch { alerta('‚ùå JSON inv√°lido', 'error'); }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function cargarJSON() {
            const j = document.getElementById('json-txt').value.trim();
            if (!j) { alerta('‚ö†Ô∏è Pega JSON', 'error'); return; }
            try {
                const x = JSON.parse(j);
                resp = x.resp; prov = x.prov; cat = x.cat; prod = x.prod; mov = x.mov; user = x.user; id = x.id;
                save();
                document.getElementById('json-txt').value = '';
                actualizar();
                alerta('‚úÖ Cargado', 'success');
            } catch { alerta('‚ùå JSON inv√°lido', 'error'); }
        }

        function alerta(m, t) {
            const d = document.getElementById('alerta');
            d.innerHTML = `<div class="alert ${t}">${m}</div>`;
            setTimeout(() => d.innerHTML = '', 3000);
        }

        window.addEventListener('load', init);
    </script>
</body>
</html>
