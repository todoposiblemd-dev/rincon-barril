<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Rinc√≥n del Barril - Inventario</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #8B0000 0%, #C41E3A 100%); min-height: 100vh; padding: 10px; }
        .container { max-width: 700px; margin: 0 auto; }
        .header { background: white; border-radius: 15px 15px 0 0; padding: 15px; text-align: center; border-bottom: 3px solid #8B0000; }
        .header h1 { color: #8B0000; font-size: 20px; margin-bottom: 5px; }
        .user-section { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f0f0f0; border-radius: 6px; font-size: 11px; margin-top: 10px; gap: 8px; flex-wrap: wrap; }
        .user-badge { background: #8B0000; color: white; padding: 4px 10px; border-radius: 15px; font-weight: 600; cursor: pointer; }
        .status-badge { display: inline-block; background: #4CAF50; color: white; padding: 4px 10px; border-radius: 15px; font-weight: 600; font-size: 10px; }
        .btn-section { display: flex; gap: 6px; }
        .sync-btn { background: #2196F3; color: white; padding: 4px 10px; border-radius: 4px; border: none; cursor: pointer; font-size: 10px; font-weight: 600; }
        .tabs { display: flex; background: white; padding: 0 10px; border-bottom: 1px solid #DDD; overflow-x: auto; flex-wrap: wrap; }
        .tab-btn { flex: 1; padding: 10px 6px; background: none; border: none; cursor: pointer; font-weight: 600; color: #999; border-bottom: 3px solid transparent; font-size: 9px; min-width: 40px; white-space: nowrap; }
        .tab-btn.active { color: #8B0000; border-bottom-color: #8B0000; }
        .content { background: white; padding: 15px; border-radius: 0 0 15px 15px; min-height: 600px; max-height: 80vh; overflow-y: auto; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .search-box { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #DDD; border-radius: 6px; font-size: 13px; }
        .filter-buttons { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 15px; }
        .filter-btn { padding: 6px 10px; border: 1px solid #DDD; background: white; border-radius: 15px; cursor: pointer; font-size: 11px; font-weight: 600; color: #666; }
        .filter-btn.active { background: #8B0000; color: white; border-color: #8B0000; }
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; font-size: 11px; font-weight: 600; margin-bottom: 4px; color: #333; }
        .form-group input, .form-group select { width: 100%; padding: 8px; border: 1px solid #DDD; border-radius: 4px; font-size: 12px; font-family: inherit; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .btn { padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px; }
        .btn-primary { background: #8B0000; color: white; width: 100%; }
        .btn-secondary { background: #f0f0f0; color: #333; width: 100%; border: 1px solid #DDD; }
        .btn-small { background: #f44336; color: white; padding: 4px 8px; font-size: 10px; border: none; border-radius: 3px; cursor: pointer; }
        .producto-card { background: #f9f9f9; border: 1px solid #EEE; border-radius: 6px; padding: 10px; margin-bottom: 8px; display: flex; justify-content: space-between; }
        .producto-info { flex: 1; }
        .producto-nombre { font-weight: 600; font-size: 12px; }
        .producto-categoria { font-size: 10px; color: #999; margin-top: 2px; }
        .producto-saldo { font-size: 13px; font-weight: 600; color: #8B0000; text-align: right; }
        .alerta { padding: 10px; border-radius: 6px; margin-bottom: 15px; font-size: 12px; font-weight: 600; }
        .alerta.success { background: #E8F5E9; color: #2E7D32; }
        .alerta.error { background: #FFEBEE; color: #C62828; }
        .alerta.info { background: #E3F2FD; color: #1565C0; }
        .lista-item { background: #f9f9f9; padding: 8px; margin-bottom: 6px; border-radius: 4px; font-size: 11px; border-left: 3px solid #8B0000; }
        .scroll-section { max-height: 300px; overflow-y: auto; }
        .estado-btn { padding: 6px 12px; border: 1px solid #DDD; background: white; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 11px; }
        .estado-btn.active { background: #8B0000; color: white; border-color: #8B0000; }
        h3 { color: #8B0000; font-size: 12px; margin-bottom: 10px; border-bottom: 2px solid #8B0000; padding-bottom: 8px; }
        .admin-item { background: #f9f9f9; padding: 8px; margin-bottom: 6px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; font-size: 11px; }
        .admin-list { background: #f9f9f9; padding: 8px; border-radius: 4px; margin-bottom: 10px; }
        textarea { width: 100%; padding: 8px; border: 1px solid #DDD; border-radius: 4px; font-size: 12px; font-family: monospace; min-height: 100px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçñ El Rinc√≥n del Barril</h1>
            <p>Gesti√≥n de Inventario v10</p>
            <div class="user-section">
                <div style="flex: 1;"><span class="user-badge" onclick="cambiarUsuario()">üë§ <span id="usuario-actual">Bodega</span></span></div>
                <div style="flex: 1;"><span class="status-badge">‚úÖ Mov: <span id="contador">0</span></span></div>
                <div class="btn-section">
                    <button class="sync-btn" onclick="descargarDatos()" title="Descargar JSON">üì•</button>
                    <button class="sync-btn" onclick="cargarDatos()" title="Cargar JSON">üì§</button>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="cambiarTab('saldos')">üìä Saldos</button>
            <button class="tab-btn" onclick="cambiarTab('entradas')">üì• Entradas</button>
            <button class="tab-btn" onclick="cambiarTab('salidas')">üì§ Salidas</button>
            <button class="tab-btn" onclick="cambiarTab('reportes')">üìà Reportes</button>
            <button class="tab-btn" onclick="cambiarTab('admin')">‚öôÔ∏è Admin</button>
        </div>

        <div class="content">
            <div id="alerta"></div>

            <!-- TAB SALDOS -->
            <div id="saldos" class="tab-content active">
                <input type="text" id="buscar-saldos" class="search-box" placeholder="üîç Buscar producto..." oninput="buscarSaldos(this.value)">
                <h3>Filtrar por Categor√≠a</h3>
                <div class="filter-buttons" id="filter-buttons"></div>
                <div id="lista-saldos"></div>
            </div>

            <!-- TAB ENTRADAS -->
            <div id="entradas" class="tab-content">
                <h3>Registrar Entrada (Compra)</h3>
                <div class="form-group"><label>Responsable *</label><select id="responsable-entrada"></select></div>
                <div class="form-group"><label>Proveedor *</label><select id="proveedor-entrada"></select></div>
                <div class="form-group"><label>Producto *</label><select id="producto-entrada" onchange="actualizarEstadoEntrada()"></select></div>
                <div id="estado-entrada-grupo" style="display: none;">
                    <label style="font-size: 11px; font-weight: 600; margin-bottom: 8px; display: block;">Estado</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px;">
                        <button type="button" class="estado-btn" onclick="seleccionarEstadoEntrada(this, 'crudo')">Crudo</button>
                        <button type="button" class="estado-btn active" onclick="seleccionarEstadoEntrada(this, 'cocido')">Cocido</button>
                    </div>
                    <input type="hidden" id="estado-entrada" value="cocido">
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Cantidad *</label><input type="number" id="cantidad-entrada" placeholder="0.00" step="0.01"></div>
                    <div class="form-group"><label>Costo *</label><input type="number" id="costo-entrada" placeholder="0.00" step="0.01"></div>
                </div>
                <div class="form-row" style="gap: 8px;"><button class="btn btn-primary" onclick="registrarEntrada()">‚úÖ Registrar</button><button class="btn btn-secondary" onclick="limpiarFormEntrada()">üîÑ Limpiar</button></div>
                <h3 style="margin-top: 15px;">√öltimas Entradas</h3>
                <div class="scroll-section" id="lista-entradas"></div>
            </div>

            <!-- TAB SALIDAS -->
            <div id="salidas" class="tab-content">
                <h3>Registrar Salida</h3>
                <div class="form-group"><label>Responsable *</label><select id="responsable-salida"></select></div>
                <div class="form-group"><label>Destino *</label><select id="destino-salida"><option value="">-- Selecciona --</option><option value="cocina">üë®‚Äçüç≥ Cocina</option><option value="caja">üí∞ Caja</option><option value="barril">üçñ Barril</option><option value="consumo">ü•ò Consumo</option><option value="merma">üìâ Merma</option><option value="danio">üî• Da√±o</option></select></div>
                <div class="form-group"><label>Producto *</label><select id="producto-salida" onchange="actualizarEstadoSalida()"></select></div>
                <div id="estado-salida-grupo" style="display: none;">
                    <label style="font-size: 11px; font-weight: 600; margin-bottom: 8px; display: block;">Estado</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px;">
                        <button type="button" class="estado-btn" onclick="seleccionarEstadoSalida(this, 'crudo')">Crudo</button>
                        <button type="button" class="estado-btn active" onclick="seleccionarEstadoSalida(this, 'cocido')">Cocido</button>
                    </div>
                    <input type="hidden" id="estado-salida" value="cocido">
                </div>
                <div class="form-group"><label>Cantidad *</label><input type="number" id="cantidad-salida" placeholder="0.00" step="0.01"></div>
                <div class="form-row" style="gap: 8px;"><button class="btn btn-primary" onclick="registrarSalida()">‚úÖ Registrar</button><button class="btn btn-secondary" onclick="limpiarFormSalida()">üîÑ Limpiar</button></div>
                <h3 style="margin-top: 15px;">√öltimas Salidas</h3>
                <div class="scroll-section" id="lista-salidas"></div>
            </div>

            <!-- TAB REPORTES -->
            <div id="reportes" class="tab-content">
                <h3>Movimientos de Hoy</h3>
                <div class="scroll-section" id="lista-reportes"></div>
            </div>

            <!-- TAB ADMIN -->
            <div id="admin" class="tab-content">
                <h3>üîí Administraci√≥n</h3>

                <h3 style="margin-top: 15px;">Responsables</h3>
                <div class="form-row" style="margin-bottom: 10px;">
                    <input type="text" id="nuevo-responsable" placeholder="Nombre">
                    <button class="btn btn-primary" onclick="agregarResponsable()">‚úÖ Agregar</button>
                </div>
                <div class="admin-list" id="lista-responsables"></div>

                <h3>Proveedores</h3>
                <div class="form-row" style="margin-bottom: 10px;">
                    <input type="text" id="nuevo-proveedor" placeholder="Nombre">
                    <button class="btn btn-primary" onclick="agregarProveedor()">‚úÖ Agregar</button>
                </div>
                <div class="admin-list" id="lista-proveedores"></div>

                <h3>Categor√≠as</h3>
                <div class="form-row" style="margin-bottom: 10px;">
                    <input type="text" id="nueva-categoria" placeholder="Ej: üçñ Prote√≠nas">
                    <button class="btn btn-primary" onclick="agregarCategoria()">‚úÖ Agregar</button>
                </div>
                <div class="admin-list" id="lista-categorias"></div>

                <h3>Productos</h3>
                <div class="form-group"><label>Nombre *</label><input type="text" id="nuevo-producto-nombre" placeholder="Nombre"></div>
                <div class="form-group"><label>Categor√≠a *</label><select id="nuevo-producto-categoria"></select></div>
                <div class="form-group"><label>Stock M√≠nimo</label><input type="number" id="nuevo-producto-minimo" placeholder="0" min="0" step="0.01"></div>
                <button class="btn btn-primary" onclick="agregarProducto()" style="margin-bottom: 10px;">‚úÖ Agregar Producto</button>
                <div class="admin-list" id="lista-productos"></div>

                <h3>Datos</h3>
                <p style="font-size: 11px; color: #666; margin-bottom: 10px;">Descarga tus datos como JSON para respaldarlos o transferirlos a otro dispositivo.</p>
                <button class="btn btn-secondary" onclick="descargarDatos()" style="margin-bottom: 10px;">üì• Descargar Todos los Datos (JSON)</button>
                <h3>Cargar Datos Anteriores</h3>
                <p style="font-size: 11px; color: #666; margin-bottom: 10px;">Pega tu JSON aqu√≠ para restaurar datos:</p>
                <textarea id="json-input" placeholder="Pega tu JSON aqu√≠..."></textarea>
                <button class="btn btn-primary" onclick="cargarDesdeJSON()" style="margin-top: 10px;">üì§ Cargar Datos</button>
            </div>
        </div>
    </div>

    <script>
        let responsables = ['Bodega', 'Cocinero', 'Cajero', 'Gerente'];
        let proveedores = ['Atlantic', 'mis tres amores', 'Carnes xyz', 'Distribuidora Local'];
        let categorias = ['üçñ Prote√≠nas', 'üßÄ L√°cteos', '‚ùÑÔ∏è Congelados', 'üåæ Secos', 'ü•¨ Verduras'];
        let saldos = [
            {id: 1, nombre: 'Costilla de cerdo', categoria: 'üçñ Prote√≠nas', saldoCrudo: 3.95, saldoCocido: 0, unidad: 'kg', minimo: 5},
            {id: 2, nombre: 'Pollo', categoria: 'üçñ Prote√≠nas', saldoCrudo: 16, saldoCocido: 0, unidad: 'kg', minimo: 7},
            {id: 3, nombre: 'Papa', categoria: '‚ùÑÔ∏è Congelados', saldoCrudo: 12.5, saldoCocido: 0, unidad: 'kg', minimo: 10},
            {id: 4, nombre: 'Queso cheddar', categoria: 'üßÄ L√°cteos', saldoCrudo: 207, saldoCocido: 0, unidad: 'kg', minimo: 80},
            {id: 5, nombre: 'Chicharr√≥n', categoria: 'üçñ Prote√≠nas', saldoCrudo: 7.7, saldoCocido: 0, unidad: 'kg', minimo: 7},
            {id: 6, nombre: 'Lomo de cerdo', categoria: 'üçñ Prote√≠nas', saldoCrudo: 9.71, saldoCocido: 0, unidad: 'kg', minimo: 4},
            {id: 7, nombre: 'Punta de anca', categoria: 'üçñ Prote√≠nas', saldoCrudo: 3.04, saldoCocido: 0, unidad: 'kg', minimo: 2},
            {id: 8, nombre: 'Carne molida CAB', categoria: 'üçñ Prote√≠nas', saldoCrudo: 17.47, saldoCocido: 0, unidad: 'kg', minimo: 0},
            {id: 9, nombre: 'Carne molida regular', categoria: 'üçñ Prote√≠nas', saldoCrudo: 24.6, saldoCocido: 0, unidad: 'kg', minimo: 4},
            {id: 10, nombre: 'Croquetas de carne', categoria: 'üçñ Prote√≠nas', saldoCrudo: 74, saldoCocido: 0, unidad: 'kg', minimo: 70},
            {id: 11, nombre: 'Tocineta', categoria: 'üçñ Prote√≠nas', saldoCrudo: 7.6, saldoCocido: 0, unidad: 'kg', minimo: 3},
            {id: 12, nombre: 'Salchichas', categoria: 'üçñ Prote√≠nas', saldoCrudo: 19, saldoCocido: 0, unidad: 'kg', minimo: 15},
            {id: 13, nombre: 'Pan brioche de hamburguesa', categoria: 'üåæ Secos', saldoCrudo: 46, saldoCocido: 0, unidad: 'kg', minimo: 30},
            {id: 14, nombre: 'Pan brioche de perro', categoria: 'üåæ Secos', saldoCrudo: 13, saldoCocido: 0, unidad: 'kg', minimo: 10},
            {id: 15, nombre: 'Papa pastusa', categoria: 'ü•¨ Verduras', saldoCrudo: 14, saldoCocido: 0, unidad: 'kg', minimo: 4},
            {id: 16, nombre: 'Cebolla cabezona', categoria: 'ü•¨ Verduras', saldoCrudo: 18, saldoCocido: 0, unidad: 'kg', minimo: 10},
            {id: 17, nombre: 'Tomate', categoria: 'ü•¨ Verduras', saldoCrudo: 12, saldoCocido: 0, unidad: 'kg', minimo: 5},
        ];
        let movimientos = [];
        let usuarioActual = 'Bodega';
        let filtroActual = 'todos';
        let proximoId = 18;

        function inicializar() {
            cargarDatosLocal();
            actualizarSelectos();
            actualizarFiltros();
            actualizarListaSaldos();
            actualizarListaEntradas();
            actualizarListaSalidas();
            actualizarReportes();
            actualizarAdmin();
            document.getElementById('usuario-actual').textContent = usuarioActual;
            actualizarContador();
            mostrarAlerta('‚úÖ Sistema listo - Datos guardados localmente', 'info');
        }

        function cargarDatosLocal() {
            const datos = localStorage.getItem('inventario_rincon_v10');
            if (datos) {
                const d = JSON.parse(datos);
                responsables = d.responsables || responsables;
                proveedores = d.proveedores || proveedores;
                categorias = d.categorias || categorias;
                saldos = d.saldos || saldos;
                movimientos = d.movimientos || [];
                usuarioActual = d.usuarioActual || 'Bodega';
                proximoId = d.proximoId || 18;
            }
        }

        function guardarDatosLocal() {
            localStorage.setItem('inventario_rincon_v10', JSON.stringify({
                responsables, proveedores, categorias, saldos, movimientos, usuarioActual, proximoId
            }));
        }

        function descargarDatos() {
            const datos = { responsables, proveedores, categorias, saldos, movimientos, usuarioActual, proximoId, fecha: new Date().toISOString() };
            const json = JSON.stringify(datos, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `inventario_rincon_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            mostrarAlerta('‚úÖ Datos descargados', 'success');
        }

        function cargarDatos() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const datos = JSON.parse(event.target.result);
                        responsables = datos.responsables || responsables;
                        proveedores = datos.proveedores || proveedores;
                        categorias = datos.categorias || categorias;
                        saldos = datos.saldos || saldos;
                        movimientos = datos.movimientos || [];
                        usuarioActual = datos.usuarioActual || 'Bodega';
                        proximoId = datos.proximoId || 18;
                        guardarDatosLocal();
                        actualizarSelectos();
                        actualizarFiltros();
                        actualizarListaSaldos();
                        actualizarListaEntradas();
                        actualizarListaSalidas();
                        actualizarReportes();
                        actualizarAdmin();
                        document.getElementById('usuario-actual').textContent = usuarioActual;
                        actualizarContador();
                        mostrarAlerta('‚úÖ Datos cargados correctamente', 'success');
                    } catch(error) {
                        mostrarAlerta('‚ùå Error: archivo JSON inv√°lido', 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function cargarDesdeJSON() {
            const json = document.getElementById('json-input').value.trim();
            if (!json) {
                mostrarAlerta('‚ö†Ô∏è Pega el JSON primero', 'error');
                return;
            }
            try {
                const datos = JSON.parse(json);
                responsables = datos.responsables || responsables;
                proveedores = datos.proveedores || proveedores;
                categorias = datos.categorias || categorias;
                saldos = datos.saldos || saldos;
                movimientos = datos.movimientos || [];
                usuarioActual = datos.usuarioActual || 'Bodega';
                proximoId = datos.proximoId || 18;
                guardarDatosLocal();
                actualizarSelectos();
                actualizarFiltros();
                actualizarListaSaldos();
                actualizarListaEntradas();
                actualizarListaSalidas();
                actualizarReportes();
                actualizarAdmin();
                document.getElementById('usuario-actual').textContent = usuarioActual;
                actualizarContador();
                document.getElementById('json-input').value = '';
                mostrarAlerta('‚úÖ Datos cargados correctamente', 'success');
            } catch(error) {
                mostrarAlerta('‚ùå Error: JSON inv√°lido', 'error');
            }
        }

        function actualizarSelectos() {
            const resp = responsables.map(r => `<option value="${r}">${r}</option>`).join('');
            const prov = proveedores.map(p => `<option value="${p}">${p}</option>`).join('');
            const prod = saldos.map(s => `<option value="${s.id}">${s.nombre}</option>`).join('');
            const cat = categorias.map(c => `<option value="${c}">${c}</option>`).join('');

            document.getElementById('responsable-entrada').innerHTML = `<option value="">-- Selecciona --</option>${resp}`;
            document.getElementById('responsable-salida').innerHTML = `<option value="">-- Selecciona --</option>${resp}`;
            document.getElementById('proveedor-entrada').innerHTML = `<option value="">-- Selecciona --</option>${prov}`;
            document.getElementById('producto-entrada').innerHTML = `<option value="">-- Selecciona --</option>${prod}`;
            document.getElementById('producto-salida').innerHTML = `<option value="">-- Selecciona --</option>${prod}`;
            document.getElementById('nuevo-producto-categoria').innerHTML = `<option value="">-- Selecciona --</option>${cat}`;
        }

        function actualizarFiltros() {
            const fb = document.getElementById('filter-buttons');
            fb.innerHTML = '<button class="filter-btn active" onclick="filtrarSaldos(event, \'todos\')">Todos</button>';
            const cats = [...new Set(saldos.map(p => p.categoria))].sort();
            cats.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = 'filter-btn';
                btn.textContent = cat;
                btn.onclick = (e) => filtrarSaldos(e, cat);
                fb.appendChild(btn);
            });
        }

        function cambiarTab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            event.target.classList.add('active');
        }

        function cambiarUsuario() {
            const opciones = responsables.map((r, i) => `${i + 1}. ${r}`).join('\n');
            const seleccion = prompt(`Selecciona responsable:\n${opciones}`);
            const idx = parseInt(seleccion) - 1;
            if (idx >= 0 && idx < responsables.length) {
                usuarioActual = responsables[idx];
                document.getElementById('usuario-actual').textContent = usuarioActual;
                guardarDatosLocal();
            }
        }

        function filtrarSaldos(event, categoria) {
            filtroActual = categoria;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            actualizarListaSaldos();
        }

        function buscarSaldos(termino) {
            const productos = filtroActual === 'todos' ? saldos : saldos.filter(p => p.categoria === filtroActual);
            const resultados = productos.filter(p => p.nombre.toLowerCase().includes(termino.toLowerCase()));
            mostrarProductos(resultados);
        }

        function actualizarListaSaldos() {
            const productos = filtroActual === 'todos' ? saldos : saldos.filter(p => p.categoria === filtroActual);
            mostrarProductos(productos);
        }

        function mostrarProductos(productos) {
            const lista = document.getElementById('lista-saldos');
            if (productos.length === 0) {
                lista.innerHTML = '<p style="color: #999; text-align: center;">Sin productos</p>';
                return;
            }
            lista.innerHTML = productos.map(p => {
                const total = p.saldoCrudo + p.saldoCocido;
                const alerta = total < p.minimo ? ' style="background: #FFEBEE;"' : '';
                return `<div class="producto-card"${alerta}>
                    <div class="producto-info">
                        <div class="producto-nombre">${p.nombre}</div>
                        <div class="producto-categoria">${p.categoria}</div>
                        ${p.categoria.includes('Prote√≠na') ? 
                            `<div style="font-size: 10px; color: #666; margin-top: 4px;">üîµ ${p.saldoCrudo.toFixed(2)} | üî¥ ${p.saldoCocido.toFixed(2)} kg</div>` : 
                            `<div style="font-size: 10px; color: #666; margin-top: 4px;">Total: ${total.toFixed(2)}</div>`
                        }
                    </div>
                    <div class="producto-saldo">${total.toFixed(2)}</div>
                </div>`;
            }).join('');
        }

        function actualizarEstadoEntrada() {
            const pid = document.getElementById('producto-entrada').value;
            const p = saldos.find(s => s.id === parseInt(pid));
            document.getElementById('estado-entrada-grupo').style.display = p?.categoria.includes('Prote√≠na') ? 'block' : 'none';
        }

        function seleccionarEstadoEntrada(btn, estado) {
            document.getElementById('estado-entrada').value = estado;
            document.querySelectorAll('#estado-entrada-grupo .estado-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function registrarEntrada() {
            const resp = document.getElementById('responsable-entrada').value;
            const prov = document.getElementById('proveedor-entrada').value;
            const pid = document.getElementById('producto-entrada').value;
            const cant = parseFloat(document.getElementById('cantidad-entrada').value);
            const costo = parseFloat(document.getElementById('costo-entrada').value);

            if (!resp || !prov || !pid || isNaN(cant) || isNaN(costo)) {
                mostrarAlerta('‚ö†Ô∏è Completa todos los campos', 'error');
                return;
            }

            const p = saldos.find(s => s.id === parseInt(pid));
            const estado = p?.categoria.includes('Prote√≠na') ? document.getElementById('estado-entrada').value : '';
            
            if (estado === 'crudo') p.saldoCrudo += cant;
            else if (estado === 'cocido') p.saldoCocido += cant;
            else p.saldoCrudo += cant;

            movimientos.push({
                fecha: new Date().toISOString().split('T')[0],
                hora: new Date().toTimeString().slice(0, 5),
                tipo: 'entrada',
                cantidadCrudo: estado === 'crudo' ? cant : 0,
                cantidadCocido: estado === 'cocido' ? cant : 0,
                producto: p?.nombre,
                estado: estado,
                responsable: resp,
                costo: costo,
                proveedor: prov
            });

            guardarDatosLocal();
            mostrarAlerta('‚úÖ Entrada registrada', 'success');
            limpiarFormEntrada();
            actualizarListaSaldos();
            actualizarListaEntradas();
            actualizarReportes();
            actualizarContador();
        }

        function actualizarListaEntradas() {
            const lista = document.getElementById('lista-entradas');
            const ultimas = movimientos.filter(m => m.tipo === 'entrada').slice(-10).reverse();
            if (ultimas.length === 0) { lista.innerHTML = '<p style="color: #999;">Sin entradas</p>'; return; }
            lista.innerHTML = ultimas.map(m => `<div class="lista-item"><strong>${m.producto}</strong><br>${m.cantidadCrudo > 0 ? m.cantidadCrudo.toFixed(2) + ' crudo | ' : ''}${m.cantidadCocido > 0 ? m.cantidadCocido.toFixed(2) + ' cocido | ' : ''}${m.proveedor} | $${m.costo}</div>`).join('');
        }

        function limpiarFormEntrada() {
            document.getElementById('responsable-entrada').value = '';
            document.getElementById('proveedor-entrada').value = '';
            document.getElementById('producto-entrada').value = '';
            document.getElementById('cantidad-entrada').value = '';
            document.getElementById('costo-entrada').value = '';
        }

        function actualizarEstadoSalida() {
            const pid = document.getElementById('producto-salida').value;
            const p = saldos.find(s => s.id === parseInt(pid));
            document.getElementById('estado-salida-grupo').style.display = p?.categoria.includes('Prote√≠na') ? 'block' : 'none';
        }

        function seleccionarEstadoSalida(btn, estado) {
            document.getElementById('estado-salida').value = estado;
            document.querySelectorAll('#estado-salida-grupo .estado-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function registrarSalida() {
            const resp = document.getElementById('responsable-salida').value;
            const dest = document.getElementById('destino-salida').value;
            const pid = document.getElementById('producto-salida').value;
            const cant = parseFloat(document.getElementById('cantidad-salida').value);

            if (!resp || !dest || !pid || isNaN(cant)) {
                mostrarAlerta('‚ö†Ô∏è Completa todos los campos', 'error');
                return;
            }

            const p = saldos.find(s => s.id === parseInt(pid));
            const estado = p?.categoria.includes('Prote√≠na') ? document.getElementById('estado-salida').value : '';
            const disponible = estado === 'crudo' ? p.saldoCrudo : estado === 'cocido' ? p.saldoCocido : p.saldoCrudo + p.saldoCocido;

            if (cant > disponible) {
                mostrarAlerta(`‚ö†Ô∏è Stock insuficiente: ${disponible.toFixed(2)}`, 'error');
                return;
            }

            if (estado === 'crudo') p.saldoCrudo -= cant;
            else if (estado === 'cocido') p.saldoCocido -= cant;
            else p.saldoCrudo -= cant;

            movimientos.push({
                fecha: new Date().toISOString().split('T')[0],
                hora: new Date().toTimeString().slice(0, 5),
                tipo: 'salida',
                cantidadCrudo: estado === 'crudo' ? cant : 0,
                cantidadCocido: estado === 'cocido' ? cant : 0,
                producto: p?.nombre,
                estado: estado,
                responsable: resp,
                destinoOrigen: dest,
                costo: 0,
                proveedor: ''
            });

            guardarDatosLocal();
            mostrarAlerta('‚úÖ Salida registrada', 'success');
            limpiarFormSalida();
            actualizarListaSaldos();
            actualizarListaSalidas();
            actualizarReportes();
            actualizarContador();
        }

        function actualizarListaSalidas() {
            const lista = document.getElementById('lista-salidas');
            const ultimas = movimientos.filter(m => m.tipo === 'salida').slice(-10).reverse();
            if (ultimas.length === 0) { lista.innerHTML = '<p style="color: #999;">Sin salidas</p>'; return; }
            const dest = {'cocina': 'üë®‚Äçüç≥', 'barril': 'üçñ', 'caja': 'üí∞', 'consumo': 'ü•ò', 'merma': 'üìâ', 'danio': 'üî•'};
            lista.innerHTML = ultimas.map(m => `<div class="lista-item"><strong>${m.producto}</strong><br>${dest[m.destinoOrigen] || ''} ${m.cantidadCrudo > 0 ? m.cantidadCrudo.toFixed(2) + ' crudo' : ''}${m.cantidadCocido > 0 ? ' / ' + m.cantidadCocido.toFixed(2) + ' cocido' : ''} | ${m.responsable}</div>`).join('');
        }

        function limpiarFormSalida() {
            document.getElementById('responsable-salida').value = '';
            document.getElementById('destino-salida').value = '';
            document.getElementById('producto-salida').value = '';
            document.getElementById('cantidad-salida').value = '';
        }

        function actualizarReportes() {
            const hoy = new Date().toISOString().split('T')[0];
            const lista = document.getElementById('lista-reportes');
            const hoyMov = movimientos.filter(m => m.fecha === hoy);
            if (hoyMov.length === 0) { lista.innerHTML = '<p style="color: #999;">Sin movimientos hoy</p>'; return; }
            const dest = {'cocina': 'üë®‚Äçüç≥', 'barril': 'üçñ', 'caja': 'üí∞', 'consumo': 'ü•ò', 'merma': 'üìâ', 'danio': 'üî•'};
            lista.innerHTML = hoyMov.map(m => {
                const icono = m.tipo === 'entrada' ? 'üì•' : 'üì§';
                return `<div class="lista-item"><strong>${icono} ${m.hora} - ${m.producto}</strong><br>${m.cantidadCrudo > 0 ? m.cantidadCrudo.toFixed(2) + ' crudo' : ''}${m.cantidadCocido > 0 ? ' / ' + m.cantidadCocido.toFixed(2) + ' cocido' : ''} | ${m.responsable}${m.tipo === 'entrada' ? ' | $' + m.costo : ''}</div>`;
            }).join('');
        }

        function actualizarContador() {
            const hoy = new Date().toISOString().split('T')[0];
            const cont = movimientos.filter(m => m.fecha === hoy).length;
            document.getElementById('contador').textContent = cont;
        }

        function agregarResponsable() {
            const nombre = document.getElementById('nuevo-responsable').value.trim();
            if (!nombre) { mostrarAlerta('‚ö†Ô∏è Nombre requerido', 'error'); return; }
            if (responsables.includes(nombre)) { mostrarAlerta('‚ö†Ô∏è Ya existe', 'error'); return; }
            responsables.push(nombre);
            guardarDatosLocal();
            actualizarSelectos();
            actualizarAdmin();
            document.getElementById('nuevo-responsable').value = '';
            mostrarAlerta('‚úÖ Responsable agregado', 'success');
        }

        function agregarProveedor() {
            const nombre = document.getElementById('nuevo-proveedor').value.trim();
            if (!nombre) { mostrarAlerta('‚ö†Ô∏è Nombre requerido', 'error'); return; }
            if (proveedores.includes(nombre)) { mostrarAlerta('‚ö†Ô∏è Ya existe', 'error'); return; }
            proveedores.push(nombre);
            guardarDatosLocal();
            actualizarSelectos();
            actualizarAdmin();
            document.getElementById('nuevo-proveedor').value = '';
            mostrarAlerta('‚úÖ Proveedor agregado', 'success');
        }

        function agregarCategoria() {
            const nombre = document.getElementById('nueva-categoria').value.trim();
            if (!nombre) { mostrarAlerta('‚ö†Ô∏è Nombre requerido', 'error'); return; }
            if (categorias.includes(nombre)) { mostrarAlerta('‚ö†Ô∏è Ya existe', 'error'); return; }
            categorias.push(nombre);
            guardarDatosLocal();
            actualizarSelectos();
            actualizarFiltros();
            actualizarAdmin();
            document.getElementById('nueva-categoria').value = '';
            mostrarAlerta('‚úÖ Categor√≠a agregada', 'success');
        }

        function agregarProducto() {
            const nombre = document.getElementById('nuevo-producto-nombre').value.trim();
            const cat = document.getElementById('nuevo-producto-categoria').value;
            const min = parseFloat(document.getElementById('nuevo-producto-minimo').value) || 0;

            if (!nombre || !cat) { mostrarAlerta('‚ö†Ô∏è Completa los campos', 'error'); return; }
            if (saldos.find(p => p.nombre === nombre)) { mostrarAlerta('‚ö†Ô∏è Ya existe', 'error'); return; }

            saldos.push({
                id: proximoId++, 
                nombre, 
                categoria: cat, 
                saldoCrudo: 0, 
                saldoCocido: 0, 
                unidad: 'kg', 
                minimo: min
            });
            
            guardarDatosLocal();
            actualizarSelectos();
            actualizarFiltros();
            actualizarAdmin();
            document.getElementById('nuevo-producto-nombre').value = '';
            document.getElementById('nuevo-producto-minimo').value = '';
            mostrarAlerta('‚úÖ Producto agregado', 'success');
        }

        function eliminarResponsable(r) { 
            if (confirm(`¬øEliminar "${r}"?`)) {
                responsables = responsables.filter(x => x !== r); 
                guardarDatosLocal(); 
                actualizarSelectos(); 
                actualizarAdmin(); 
                mostrarAlerta('‚úÖ Eliminado', 'success'); 
            }
        }

        function eliminarProveedor(p) { 
            if (confirm(`¬øEliminar "${p}"?`)) {
                proveedores = proveedores.filter(x => x !== p); 
                guardarDatosLocal(); 
                actualizarSelectos(); 
                actualizarAdmin(); 
                mostrarAlerta('‚úÖ Eliminado', 'success'); 
            }
        }

        function eliminarCategoria(c) { 
            if (confirm(`¬øEliminar "${c}"?`)) {
                categorias = categorias.filter(x => x !== c); 
                saldos = saldos.filter(p => p.categoria !== c); 
                guardarDatosLocal(); 
                actualizarSelectos(); 
                actualizarFiltros(); 
                actualizarAdmin(); 
                mostrarAlerta('‚úÖ Eliminado', 'success'); 
            }
        }

        function eliminarProducto(id) { 
            const p = saldos.find(x => x.id === id);
            if (confirm(`¬øEliminar "${p?.nombre}"?`)) {
                saldos = saldos.filter(x => x.id !== id); 
                guardarDatosLocal(); 
                actualizarSelectos(); 
                actualizarAdmin(); 
                mostrarAlerta('‚úÖ Eliminado', 'success'); 
            }
        }

        function actualizarAdmin() {
            document.getElementById('lista-responsables').innerHTML = responsables.map(r => `<div class="admin-item"><span>${r}</span><button class="btn-small" onclick="eliminarResponsable('${r}')">‚ùå</button></div>`).join('');
            document.getElementById('lista-proveedores').innerHTML = proveedores.map(p => `<div class="admin-item"><span>${p}</span><button class="btn-small" onclick="eliminarProveedor('${p}')">‚ùå</button></div>`).join('');
            document.getElementById('lista-categorias').innerHTML = categorias.map(c => `<div class="admin-item"><span>${c}</span><button class="btn-small" onclick="eliminarCategoria('${c}')">‚ùå</button></div>`).join('');
            document.getElementById('lista-productos').innerHTML = saldos.map(p => `<div class="admin-item"><span>${p.nombre} (${(p.saldoCrudo + p.saldoCocido).toFixed(2)} kg)</span><button class="btn-small" onclick="eliminarProducto(${p.id})">‚ùå</button></div>`).join('');
        }

        function mostrarAlerta(msg, tipo) {
            const div = document.getElementById('alerta');
            div.innerHTML = `<div class="alerta ${tipo}">${msg}</div>`;
            setTimeout(() => { div.innerHTML = ''; }, 3000);
        }

        window.addEventListener('load', inicializar);
    </script>
</body>
</html>
