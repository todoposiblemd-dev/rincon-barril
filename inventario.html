<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Rinc√≥n del Barril - Gesti√≥n Materias Primas v7.4 SINCRONIZADO</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #8B0000 0%, #C41E3A 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 650px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 15px 15px 0 0;
            padding: 15px;
            text-align: center;
            border-bottom: 3px solid #8B0000;
        }

        .header h1 {
            color: #8B0000;
            font-size: 22px;
            margin-bottom: 5px;
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: #f0f0f0;
            border-radius: 6px;
            font-size: 11px;
            margin-top: 10px;
        }

        .user-badge {
            background: #8B0000;
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-weight: 600;
        }

        .tabs {
            display: flex;
            background: white;
            padding: 0 10px;
            border-bottom: 1px solid #DDD;
            overflow-x: auto;
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            padding: 10px 6px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #999;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-size: 10px;
            min-width: 50px;
            white-space: nowrap;
        }

        .tab-btn.active {
            color: #8B0000;
            border-bottom-color: #8B0000;
        }

        .content {
            background: white;
            padding: 15px;
            border-radius: 0 0 15px 15px;
            min-height: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            font-size: 12px;
        }

        select, input, textarea {
            width: 100%;
            padding: 8px;
            border: 2px solid #DDD;
            border-radius: 6px;
            font-size: 12px;
            font-family: inherit;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #8B0000;
            box-shadow: 0 0 0 3px rgba(139, 0, 0, 0.1);
        }

        .btn {
            padding: 8px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #8B0000 0%, #C41E3A 100%);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(139, 0, 0, 0.3);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
            width: 100%;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-small {
            padding: 4px 8px;
            font-size: 10px;
            width: auto;
        }

        .btn-edit {
            background: #FFC107;
            color: white;
        }

        .btn-delete {
            background: #DC3545;
            color: white;
        }

        .btn-export {
            background: #28a745;
            color: white;
            width: 100%;
            margin-bottom: 10px;
            font-size: 13px;
        }

        .btn-export:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        .alerta {
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            text-align: center;
            font-size: 11px;
        }

        .alerta.success {
            background: #D4EDDA;
            color: #155724;
        }

        .alerta.error {
            background: #F8D7DA;
            color: #721C24;
        }

        .area-saldos {
            background: #f9f9f9;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            border: 1px solid #e0e0e0;
        }

        .area-titulo {
            font-weight: 600;
            color: #8B0000;
            margin-bottom: 8px;
            border-bottom: 2px solid #8B0000;
            padding-bottom: 5px;
            font-size: 11px;
        }

        .saldo-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
            font-size: 11px;
            padding: 8px;
            background: white;
            border-radius: 4px;
            border-left: 3px solid #8B0000;
        }

        .saldo-info {
            flex: 1;
        }

        .saldo-nombre {
            font-weight: 600;
            color: #333;
        }

        .saldo-det {
            font-size: 9px;
            color: #999;
            margin-top: 2px;
        }

        .alerta-stock {
            background: #FFF3CD;
            color: #856404;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 9px;
            font-weight: 600;
            margin-top: 2px;
            display: inline-block;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow-y: auto;
        }

        .modal.active {
            display: block;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 15px;
            border-radius: 10px;
            width: 95%;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            font-size: 14px;
            font-weight: 600;
            color: #8B0000;
            margin-bottom: 12px;
            border-bottom: 2px solid #8B0000;
            padding-bottom: 8px;
        }

        .modal-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 15px;
        }

        .tabla-reportes {
            width: 100%;
            border-collapse: collapse;
            font-size: 9px;
            margin-bottom: 15px;
            background: white;
        }

        .tabla-reportes thead {
            background: #8B0000;
            color: white;
        }

        .tabla-reportes th {
            padding: 6px;
            text-align: left;
            border: 1px solid #ddd;
            font-weight: 600;
        }

        .tabla-reportes td {
            padding: 4px 6px;
            border: 1px solid #ddd;
        }

        .tabla-reportes tbody tr:nth-child(even) {
            background: #f9f9f9;
        }

        .scroll-section {
            max-height: 400px;
            overflow-y: auto;
            padding: 5px;
        }

        .filtro-reportes {
            background: #f9f9f9;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .estado-btn {
            padding: 8px;
            border: 2px solid #DDD;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
        }

        .estado-btn.active {
            background: #8B0000;
            color: white;
            border-color: #8B0000;
        }

        .tag-categoria {
            display: inline-block;
            background: #8B0000;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 9px;
            margin-right: 5px;
        }

        .info-export {
            background: #e8f4f8;
            border: 1px solid #004085;
            color: #004085;
            padding: 10px;
            border-radius: 6px;
            font-size: 11px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçñ El Rinc√≥n del Barril</h1>
            <h3 style="font-size: 12px; color: #666;">Gesti√≥n de Materias Primas v7.4</h3>
            <div class="user-info">
                <div>
                    <span style="font-weight: 600;">üë§ </span>
                    <span id="nombre-usuario">Cargando...</span>
                </div>
                <div class="user-badge" id="rol-usuario">Rol</div>
            </div>
            <div id="status-sync" style="margin-top: 10px; padding: 8px; background: #f0f0f0; border-radius: 6px; font-size: 11px; text-align: center;">
                <div>
                    <span id="indicador-conexion">üì° Conectado</span> ‚Ä¢ 
                    <span id="indicador-sincronizacion">Sincronizados: 0/72</span>
                </div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="cambiarTab('saldos')">üìä Saldos</button>
            <button class="tab-btn" onclick="cambiarTab('entradas')">üì• Entradas</button>
            <button class="tab-btn" onclick="cambiarTab('salidas')">üì§ Salidas</button>
            <button class="tab-btn" onclick="cambiarTab('responsables')">üë• Resp</button>
            <button class="tab-btn" onclick="cambiarTab('reportes')">üìà Reportes</button>
        </div>

        <div class="content">
            <div id="alerta"></div>

            <!-- TAB SALDOS -->
            <div id="saldos" class="tab-content active">
                <div style="margin-bottom: 10px;">
                    <button class="btn btn-primary btn-small" onclick="mostrarModalNuevoProducto()" style="width: 100%;">‚ûï Agregar Producto</button>
                </div>
                <div class="scroll-section" id="lista-saldos"></div>
            </div>

            <!-- TAB ENTRADAS -->
            <div id="entradas" class="tab-content">
                <div style="display: flex; gap: 8px; align-items: flex-end; margin-bottom: 12px;">
                    <div class="form-group" style="flex: 1; margin-bottom: 0;">
                        <label>Proveedor *</label>
                        <select id="proveedor-entrada" required></select>
                    </div>
                    <button class="btn btn-primary btn-small" onclick="mostrarModalNuevoProveedor()" style="margin-bottom: 0; padding: 8px 12px;">‚ûï</button>
                </div>

                <div style="display: flex; gap: 8px; align-items: flex-end; margin-bottom: 12px;">
                    <div class="form-group" style="flex: 1; margin-bottom: 0;">
                        <label>Materia Prima *</label>
                        <select id="producto-entrada" required onchange="actualizarEstadoEntrada()"></select>
                    </div>
                    <button class="btn btn-primary btn-small" onclick="mostrarModalNuevoProducto()" style="margin-bottom: 0; padding: 8px 12px;">‚ûï</button>
                </div>

                <div id="estado-entrada-grupo" style="display: none;">
                    <label>Estado de Entrada</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <button type="button" class="estado-btn" onclick="seleccionarEstadoEntrada('crudo')">Crudo</button>
                        <button type="button" class="estado-btn active" onclick="seleccionarEstadoEntrada('cocido')">Cocido</button>
                    </div>
                    <input type="hidden" id="estado-entrada" value="cocido">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Cantidad *</label>
                        <input type="number" id="cantidad-entrada" placeholder="0.00" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Costo Unit. *</label>
                        <input type="number" id="costo-entrada" placeholder="$0" step="0.01" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Responsable *</label>
                    <select id="responsable-entrada" required></select>
                </div>

                <div class="form-row" style="gap: 8px; margin-top: 10px;">
                    <button class="btn btn-primary" onclick="registrarEntrada()">‚úÖ Registrar</button>
                    <button class="btn btn-secondary" onclick="limpiarFormEntrada()">üîÑ Limpiar</button>
                </div>

                <h3 style="margin-top: 15px; margin-bottom: 8px; color: #8B0000; font-size: 12px;">√öltimas Entradas</h3>
                <div class="scroll-section" id="lista-entradas" style="max-height: 250px;"></div>
            </div>

            <!-- TAB SALIDAS -->
            <div id="salidas" class="tab-content">
                <div class="form-group">
                    <label>Destino *</label>
                    <select id="destino-salida" required>
                        <option value="">-- Selecciona --</option>
                        <option value="cocina">üë®‚Äçüç≥ A Cocina</option>
                        <option value="barril">üçñ Al Barril</option>
                        <option value="caja">üí∞ A Caja</option>
                        <option value="consumo">ü•ò Consumo</option>
                        <option value="merma">üìâ Merma</option>
                        <option value="danio">üî• Da√±o</option>
                    </select>
                </div>

                <div style="display: flex; gap: 8px; align-items: flex-end; margin-bottom: 12px;">
                    <div class="form-group" style="flex: 1; margin-bottom: 0;">
                        <label>Materia Prima *</label>
                        <select id="producto-salida" required onchange="actualizarEstadoSalida()"></select>
                    </div>
                    <button class="btn btn-primary btn-small" onclick="mostrarModalNuevoProducto()" style="margin-bottom: 0; padding: 8px 12px;">‚ûï</button>
                </div>

                <div id="estado-salida-grupo" style="display: none;">
                    <label>Estado de Salida</label>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <button type="button" class="estado-btn" onclick="seleccionarEstadoSalida('crudo')">Crudo</button>
                        <button type="button" class="estado-btn active" onclick="seleccionarEstadoSalida('cocido')">Cocido</button>
                    </div>
                    <input type="hidden" id="estado-salida" value="cocido">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Cantidad *</label>
                        <input type="number" id="cantidad-salida" placeholder="0.00" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Responsable *</label>
                        <select id="responsable-salida" required></select>
                    </div>
                </div>

                <div class="form-row" style="gap: 8px; margin-top: 10px;">
                    <button class="btn btn-primary" onclick="registrarSalida()">‚úÖ Registrar</button>
                    <button class="btn btn-secondary" onclick="limpiarFormSalida()">üîÑ Limpiar</button>
                </div>

                <h3 style="margin-top: 15px; margin-bottom: 8px; color: #8B0000; font-size: 12px;">√öltimas Salidas</h3>
                <div class="scroll-section" id="lista-salidas" style="max-height: 250px;"></div>
            </div>

            <!-- TAB RESPONSABLES -->
            <div id="responsables" class="tab-content">
                <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                    <input type="text" id="nuevo-responsable" placeholder="Nuevo responsable" style="flex: 1;">
                    <button class="btn btn-primary btn-small" onclick="agregarResponsable()" style="width: auto;">Agregar</button>
                </div>
                <div class="scroll-section" id="lista-responsables"></div>
            </div>

            <!-- TAB REPORTES -->
            <div id="reportes" class="tab-content">
                <div class="info-export">
                    üì• <strong>Stock Actual + Movimientos</strong>
                </div>

                <div class="filtro-reportes">
                    <label>Rango de Fechas</label>
                    <div class="form-row">
                        <input type="date" id="fecha-desde" onchange="actualizarReportes()">
                        <input type="date" id="fecha-hasta" onchange="actualizarReportes()">
                    </div>
                </div>

                <h3 style="color: #8B0000; margin: 15px 0 10px 0; font-size: 12px;">üìä STOCK ACTUAL</h3>
                <div class="scroll-section" id="tabla-stock-actual" style="max-height: 300px;"></div>

                <h3 style="color: #8B0000; margin: 15px 0 10px 0; font-size: 12px;">üìã TODOS LOS MOVIMIENTOS</h3>
                <div class="scroll-section" id="tabla-movimientos" style="max-height: 300px;"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- MODAL NUEVO PRODUCTO -->
    <div id="modalNuevoProducto" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">‚ûï Nuevo Producto</div>
            <div class="form-group">
                <label>Nombre *</label>
                <input type="text" id="nuevo-producto-nombre" placeholder="Ej: Cilantro fresco">
            </div>
            <div class="form-group">
                <label>Categor√≠a *</label>
                <select id="nuevo-producto-categoria" required></select>
            </div>
            <div class="form-group">
                <label>Stock M√≠nimo</label>
                <input type="number" id="nuevo-producto-minimo" placeholder="0" step="0.01" value="0">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="guardarProductoNuevo()">‚úÖ Guardar</button>
                <button class="btn btn-secondary" onclick="cerrarModalNuevoProducto()">‚ùå Cancelar</button>
            </div>
        </div>
    </div>

    <!-- MODAL NUEVO PROVEEDOR -->
    <div id="modalNuevoProveedor" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">‚ûï Nuevo Proveedor</div>
            <div class="form-group">
                <label>Nombre *</label>
                <input type="text" id="nuevo-proveedor-nombre" placeholder="Ej: Fruver Centro">
            </div>
            <div class="form-group">
                <label>Tel√©fono</label>
                <input type="text" id="nuevo-proveedor-telefono" placeholder="+57 300 1234567">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="guardarProveedorNuevo()">‚úÖ Guardar</button>
                <button class="btn btn-secondary" onclick="cerrarModalNuevoProveedor()">‚ùå Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // ===== CONFIGURACI√ìN INICIAL =====
        const CATEGORIAS_INICIALES = {
            'proteinas': 'üçñ Prote√≠nas',
            'lacteos': 'üßÄ L√°cteos',
            'congelados': '‚ùÑÔ∏è Congelados',
            'secos': 'üåæ Secos',
            'verduras': 'ü•¨ Verduras',
            'gaseosas': 'ü•§ Gaseosas',
            'cervezas': 'üç∫ Cervezas',
            'condimentos': 'üßÇ Condimentos/Salsas',
            'bebidas': 'üßã Bebidas Preparadas',
            'empaques': 'üì¶ Empaques'
        };

        const PRODUCTOS_INICIALES = [
            { nombre: 'Costilla de cerdo', categoria: 'proteinas', cantCruda: 3.95, cantCocida: 0, unidad: 'kg', stockMin: 5.0 },
            { nombre: 'Pollo', categoria: 'proteinas', cantCruda: 16.0, cantCocida: 0, unidad: 'kg', stockMin: 7.0 },
            { nombre: 'Queso paisa', categoria: 'lacteos', cantCruda: 0.52, cantCocida: 0, unidad: 'kg', stockMin: 1.0 },
            { nombre: 'Papa', categoria: 'congelados', cantCruda: 12.5, cantCocida: 0, unidad: 'kg', stockMin: 10.0 },
            { nombre: 'chicharron', categoria: 'proteinas', cantCruda: 0.0, cantCocida: 0, unidad: 'kg', stockMin: 7.0 },
            { nombre: 'lomo de cerdo', categoria: 'proteinas', cantCruda: 4.89, cantCocida: 0, unidad: 'kg', stockMin: 4.0 },
            { nombre: 'punta de anca', categoria: 'proteinas', cantCruda: 3.04, cantCocida: 0, unidad: 'kg', stockMin: 2.0 },
            { nombre: 'carne molida CAB', categoria: 'proteinas', cantCruda: 0.0, cantCocida: 0, unidad: 'kg', stockMin: 0 },
            { nombre: 'carne molida regular', categoria: 'proteinas', cantCruda: 9.3, cantCocida: 0, unidad: 'kg', stockMin: 4.0 },
            { nombre: 'croquetas de carne', categoria: 'proteinas', cantCruda: 74.0, cantCocida: 0, unidad: 'kg', stockMin: 70.0 },
            { nombre: 'pecho de res', categoria: 'proteinas', cantCruda: 0.0, cantCocida: 0, unidad: 'kg', stockMin: 0 },
            { nombre: 'contramuslo de pollo', categoria: 'proteinas', cantCruda: 0.0, cantCocida: 0, unidad: 'kg', stockMin: 0 },
            { nombre: 'colita de cadera', categoria: 'proteinas', cantCruda: 0.0, cantCocida: 0, unidad: 'kg', stockMin: 3.0 },
            { nombre: 'morcilla', categoria: 'proteinas', cantCruda: 1.84, cantCocida: 0, unidad: 'kg', stockMin: 0 },
            { nombre: 'chorizo', categoria: 'proteinas', cantCruda: 1.27, cantCocida: 0, unidad: 'kg', stockMin: 0.5 },
            { nombre: 'queso cheddar', categoria: 'lacteos', cantCruda: 47.0, cantCocida: 0, unidad: 'kg', stockMin: 80.0 },
            { nombre: 'tocineta', categoria: 'proteinas', cantCruda: 7.6, cantCocida: 0, unidad: 'kg', stockMin: 3.0 },
            { nombre: 'salchichas', categoria: 'proteinas', cantCruda: 19.0, cantCocida: 0, unidad: 'kg', stockMin: 15.0 },
            { nombre: 'pan brioche de hamburguesa', categoria: 'secos', cantCruda: 46.0, cantCocida: 0, unidad: 'kg', stockMin: 30.0 },
            { nombre: 'pan brioche de perro', categoria: 'secos', cantCruda: 13.0, cantCocida: 0, unidad: 'kg', stockMin: 10.0 },
            { nombre: 'papa pastusa', categoria: 'verduras', cantCruda: 0.0, cantCocida: 0, unidad: 'kg', stockMin: 4.0 },
            { nombre: 'cebolla cabezona', categoria: 'verduras', cantCruda: 2.1, cantCocida: 0, unidad: 'kg', stockMin: 3.0 },
            { nombre: 'tomate', categoria: 'verduras', cantCruda: 2.0, cantCocida: 0, unidad: 'kg', stockMin: 3.0 },
            { nombre: 'ajo pelado en bolsa', categoria: 'verduras', cantCruda: 0.0, cantCocida: 0, unidad: 'kg', stockMin: 0 },
            { nombre: 'pimenton rojo', categoria: 'verduras', cantCruda: 0.0, cantCocida: 0, unidad: 'kg', stockMin: 0 },
            { nombre: 'cebolla morada', categoria: 'verduras', cantCruda: 0.0, cantCocida: 0, unidad: 'kg', stockMin: 0 },
            { nombre: 'limon tahiti', categoria: 'verduras', cantCruda: 8.0, cantCocida: 0, unidad: 'kg', stockMin: 3.0 },
            { nombre: 'arroz zulia', categoria: 'secos', cantCruda: 0.0, cantCocida: 0, unidad: 'kg', stockMin: 2.0 },
            { nombre: 'frijol bolon rojo', categoria: 'secos', cantCruda: 1.6, cantCocida: 0, unidad: 'kg', stockMin: 1.5 },
            { nombre: 'panela', categoria: 'verduras', cantCruda: 2.0, cantCocida: 0, unidad: 'kg', stockMin: 2.0 },
            { nombre: 'mayonesa natucampo', categoria: 'lacteos', cantCruda: 3.0, cantCocida: 0, unidad: 'kg', stockMin: 1.0 },
            { nombre: 'cebolla roja', categoria: 'verduras', cantCruda: 0.0, cantCocida: 0, unidad: 'kg', stockMin: 0 },
            { nombre: 'ajo badia', categoria: 'condimentos', cantCruda: 0.53, cantCocida: 0, unidad: 'kg', stockMin: 0.3 },
            { nombre: 'pimienta molida badia', categoria: 'condimentos', cantCruda: 0.35, cantCocida: 0, unidad: 'kg', stockMin: 0.3 },
            { nombre: 'paprika', categoria: 'condimentos', cantCruda: 1.4, cantCocida: 0, unidad: 'kg', stockMin: 0.3 },
            { nombre: 'agua p600', categoria: 'gaseosas', cantCruda: 15.0, cantCocida: 0, unidad: 'und', stockMin: 12.0 },
            { nombre: 'huevos', categoria: 'lacteos', cantCruda: 21.0, cantCocida: 0, unidad: 'kg', stockMin: 12.0 },
            { nombre: 'coca cola 1.5', categoria: 'gaseosas', cantCruda: 9.0, cantCocida: 0, unidad: 'und', stockMin: 12.0 },
            { nombre: 'coca cola p400', categoria: 'gaseosas', cantCruda: 11.0, cantCocida: 0, unidad: 'und', stockMin: 12.0 },
            { nombre: 'coca cola zero 1.5', categoria: 'gaseosas', cantCruda: 1.0, cantCocida: 0, unidad: 'und', stockMin: 6.0 },
            { nombre: 'coca cola zero p400', categoria: 'gaseosas', cantCruda: 10.0, cantCocida: 0, unidad: 'und', stockMin: 6.0 },
            { nombre: 'coca cola zero p250', categoria: 'gaseosas', cantCruda: 7.0, cantCocida: 0, unidad: 'und', stockMin: 12.0 },
            { nombre: 'quatro 1.5', categoria: 'gaseosas', cantCruda: 2.0, cantCocida: 0, unidad: 'und', stockMin: 6.0 },
            { nombre: 'quatro p400', categoria: 'gaseosas', cantCruda: 8.0, cantCocida: 0, unidad: 'und', stockMin: 6.0 },
            { nombre: 'quatro p250', categoria: 'gaseosas', cantCruda: 0.0, cantCocida: 0, unidad: 'und', stockMin: 12.0 },
            { nombre: 'sprite 1.5', categoria: 'gaseosas', cantCruda: 5.0, cantCocida: 0, unidad: 'und', stockMin: 6.0 },
            { nombre: 'sprite p400', categoria: 'gaseosas', cantCruda: 6.0, cantCocida: 0, unidad: 'und', stockMin: 6.0 },
            { nombre: 'kola roman 1.5', categoria: 'gaseosas', cantCruda: 8.0, cantCocida: 0, unidad: 'und', stockMin: 6.0 },
            { nombre: 'kola roman p400', categoria: 'gaseosas', cantCruda: 4.0, cantCocida: 0, unidad: 'und', stockMin: 6.0 },
            { nombre: 'soda frutos rojos', categoria: 'gaseosas', cantCruda: 16.0, cantCocida: 0, unidad: 'und', stockMin: 6.0 },
            { nombre: 'soda frutos amarillos', categoria: 'gaseosas', cantCruda: 13.0, cantCocida: 0, unidad: 'und', stockMin: 6.0 },
            { nombre: 'cerveza', categoria: 'cervezas', cantCruda: 0.0, cantCocida: 0, unidad: 'und', stockMin: 12.0 },
            { nombre: 'crema de coco', categoria: 'bebidas', cantCruda: 0.0, cantCocida: 0, unidad: 'kg', stockMin: 0.1 },
            { nombre: 'cerezas', categoria: 'bebidas', cantCruda: 0.0, cantCocida: 0, unidad: 'kg', stockMin: 0.1 },
            { nombre: 'soda p400', categoria: 'gaseosas', cantCruda: 12.0, cantCocida: 0, unidad: 'und', stockMin: 6.0 },
            { nombre: 'Caja de hamburguesa', categoria: 'empaques', cantCruda: 0.0, cantCocida: 0, unidad: 'kg', stockMin: 100.0 },
            { nombre: 'caja para 1/2kg picada', categoria: 'empaques', cantCruda: 0.0, cantCocida: 0, unidad: 'kg', stockMin: 30.0 },
            { nombre: 'caja para 1kg picada', categoria: 'empaques', cantCruda: 45.0, cantCocida: 0, unidad: 'kg', stockMin: 30.0 },
            { nombre: 'icopor P1', categoria: 'empaques', cantCruda: 11.0, cantCocida: 0, unidad: 'kg', stockMin: 20.0 },
            { nombre: 'icopor C1', categoria: 'empaques', cantCruda: 16.0, cantCocida: 0, unidad: 'kg', stockMin: 20.0 },
            { nombre: 'contenedor 16 OZ', categoria: 'empaques', cantCruda: 75.0, cantCocida: 0, unidad: 'kg', stockMin: 20.0 },
            { nombre: 'contenedor 24 OZ', categoria: 'empaques', cantCruda: 59.0, cantCocida: 0, unidad: 'kg', stockMin: 20.0 },
            { nombre: 'potes 4 OZ ensalada', categoria: 'empaques', cantCruda: 275.0, cantCocida: 0, unidad: 'kg', stockMin: 70.0 },
            { nombre: 'potes 1 OZ salsas', categoria: 'empaques', cantCruda: 302.0, cantCocida: 0, unidad: 'kg', stockMin: 150.0 },
            { nombre: 'servilletas', categoria: 'empaques', cantCruda: 21.0, cantCocida: 0, unidad: 'kg', stockMin: 10.0 },
            { nombre: 'vasos desechables 12 OZ', categoria: 'empaques', cantCruda: 100.0, cantCocida: 0, unidad: 'kg', stockMin: 50.0 },
            { nombre: 'vasos 12 OZ con tapa para llevar limonada', categoria: 'empaques', cantCruda: 2.0, cantCocida: 0, unidad: 'kg', stockMin: 25.0 },
            { nombre: 'bolsas 2kg', categoria: 'empaques', cantCruda: 2.0, cantCocida: 0, unidad: 'kg', stockMin: 1.0 },
            { nombre: 'bolsas de 10 kg', categoria: 'empaques', cantCruda: 2.0, cantCocida: 0, unidad: 'kg', stockMin: 1.0 },
            { nombre: 'bolsas de 20 kg', categoria: 'empaques', cantCruda: 1.0, cantCocida: 0, unidad: 'kg', stockMin: 1.0 },
            { nombre: 'salsa de tomate heinz', categoria: 'condimentos', cantCruda: 3.0, cantCocida: 0, unidad: 'kg', stockMin: 1.0 },
            { nombre: 'salsa mostaza', categoria: 'condimentos', cantCruda: 1.0, cantCocida: 0, unidad: 'kg', stockMin: 1.0 }
        ];

        const PROVEEDORES_INICIALES = [
            { nombre: 'Atlantic', telefono: '+57 300 1234567' },
            { nombre: 'Novillon', telefono: '+57 300 2345678' },
            { nombre: 'Makro', telefono: '+57 300 9012345' }
        ];

        const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycbx0QrrAdIoDjvrHelSwvdqPVi9zu-ydrMah5A8pCxyzmHUmvYfpOiWhibwWAj7qFpwO/exec';

        // ===== VARIABLES GLOBALES =====
        let usuarioActual = {};
        let saldos = [];
        let movimientos = [];
        let proveedores = [];
        let responsables = ['Bodega', 'Cocinero', 'Cajero', 'Sal√≥n'];
        let categorias = { ...CATEGORIAS_INICIALES };

        // ===== FUNCIONES PRINCIPALES =====
        let ultimoMovimientoId = 0;

        async function cargarMovimientosDesdeGoogle() {
            try {
                const response = await fetch(GOOGLE_SHEET_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'getMovimientos' }),
                    mode: 'no-cors'
                });
                
                console.log('‚úÖ Movimientos cargados desde Google');
            } catch(error) {
                console.log('‚ö†Ô∏è No se pudieron cargar movimientos');
            }
        }

        // POLLING autom√°tico cada 3 segundos para sincronizaci√≥n en tiempo real
        function iniciarPolling() {
            setInterval(() => {
                // Contar movimientos locales actuales
                const movimientosActuales = movimientos.length;
                
                // Si hay nuevos movimientos, alguien m√°s registr√≥ algo
                console.log('üîÑ Polling: ' + movimientosActuales + ' movimientos locales');
                
                // Aqu√≠ se agregar√≠an nuevos movimientos que vengan de Google
                // Por ahora verificamos que el sistema responda
                document.getElementById('indicador-sincronizacion').textContent = 
                    'Sincronizados: ' + movimientosActuales + '/72';
            }, 3000);
        }

        function inicializar() {
            console.log('‚úÖ Sistema Iniciando...');
            cargarDatos();
            detectarUsuario();
            actualizarSelectoCategorias();
            actualizarSelectos();
            actualizarSaldos();
            actualizarListaResponsables();
            establecerFechasActuales();
            
            // Cargar movimientos iniciales
            setTimeout(() => {
                cargarMovimientosDesdeGoogle();
            }, 1500);

            // Iniciar polling autom√°tico
            iniciarPolling();
        }

        function detectarUsuario() {
            const usuario = prompt('üë§ Ingresa tu nombre:', '');
            const rolNum = prompt('üéØ Tu rol?\n1. Bodega\n2. Cocinero\n3. Cajero\n4. Gerente', '1');
            const rolesMap = { '1': 'Bodega', '2': 'Cocinero', '3': 'Cajero', '4': 'Gerente' };
            
            usuarioActual = {
                nombre: usuario || 'Usuario',
                rol: rolesMap[rolNum] || 'Bodega'
            };

            document.getElementById('nombre-usuario').textContent = usuarioActual.nombre;
            document.getElementById('rol-usuario').textContent = usuarioActual.rol;
        }

        function cargarDatos() {
            const datosGuardados = localStorage.getItem('datosMateriasPrimas');
            if (datosGuardados) {
                try {
                    const datos = JSON.parse(datosGuardados);
                    saldos = datos.saldos || [];
                    movimientos = datos.movimientos || [];
                    proveedores = datos.proveedores || [];
                    responsables = datos.responsables || ['Bodega', 'Cocinero', 'Cajero', 'Sal√≥n'];
                    categorias = datos.categorias || { ...CATEGORIAS_INICIALES };
                } catch(error) {
                    console.error('Error al cargar:', error);
                }
            }
            
            // CRUCIAL: Si NO hay saldos, crear los 72 productos con IDs DETERMIN√çSTICOS
            if (saldos.length === 0) {
                saldos = PRODUCTOS_INICIALES.map((p, indice) => ({
                    id: 'saldo_' + indice,  // ‚úÖ ID FIJO basado en √≠ndice, NO en Date.now()
                    nombre: p.nombre,
                    categoria: CATEGORIAS_INICIALES[p.categoria],
                    unidad: p.unidad,
                    stockMinimo: p.stockMin,
                    cantidadCruda: p.cantCruda || 0,
                    cantidadCocida: p.cantCocida || 0,
                    cantidad: 0,
                    fechaCreacion: new Date().toISOString()
                }));
                console.log('‚úÖ Creados 72 productos con IDs determin√≠sticos');
            }

            // Proveedores
            if (proveedores.length === 0) {
                proveedores = PROVEEDORES_INICIALES.map((p, i) => ({
                    id: 'prov_' + i,
                    nombre: p.nombre,
                    telefono: p.telefono
                }));
            }

            guardarDatos();
        }

        function guardarDatos() {
            localStorage.setItem('datosMateriasPrimas', JSON.stringify({
                saldos, movimientos, proveedores, responsables, categorias
            }));
        }

        function establecerFechasActuales() {
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('fecha-desde').value = hoy;
            document.getElementById('fecha-hasta').value = hoy;
        }

        function actualizarSaldos() {
            const lista = document.getElementById('lista-saldos');
            const porCategoria = {};

            saldos.forEach(saldo => {
                if (!porCategoria[saldo.categoria]) porCategoria[saldo.categoria] = [];
                porCategoria[saldo.categoria].push(saldo);
            });

            let html = '';
            Object.keys(porCategoria).forEach(cat => {
                html += `<div class="area-saldos"><div class="area-titulo">${cat}</div>`;

                porCategoria[cat].forEach(saldo => {
                    const esProteina = cat.includes('Prote√≠nas');
                    let stock = 0, alerta = '';

                    if (esProteina) {
                        const cruda = calcularSaldoCrudo(saldo.id);
                        const cocida = calcularSaldoCocido(saldo.id);
                        stock = cruda + cocida;
                        if (stock < saldo.stockMinimo) alerta = `<div class="alerta-stock">‚ö†Ô∏è ${stock.toFixed(2)}/${saldo.stockMinimo}</div>`;
                        html += `<div class="saldo-item"><div class="saldo-info"><div class="saldo-nombre">${saldo.nombre}</div><div class="saldo-det">üîµ ${cruda.toFixed(2)} | üî¥ ${cocida.toFixed(2)}</div>${alerta}</div></div>`;
                    } else {
                        stock = calcularSaldoActual(saldo.id);
                        if (stock < saldo.stockMinimo) alerta = `<div class="alerta-stock">‚ö†Ô∏è ${stock.toFixed(2)}/${saldo.stockMinimo}</div>`;
                        html += `<div class="saldo-item"><div class="saldo-info"><div class="saldo-nombre">${saldo.nombre}</div><div class="saldo-det">Stock: ${stock.toFixed(2)} ${saldo.unidad}</div>${alerta}</div></div>`;
                    }
                });

                html += '</div>';
            });

            lista.innerHTML = html;
        }

        function calcularSaldoCrudo(productoId) {
            const saldo = saldos.find(s => s.id === productoId);
            let cantidad = parseFloat(saldo?.cantidadCruda) || 0;
            movimientos.forEach(mov => {
                if (mov.producto === productoId && mov.tipo === 'entrada' && mov.estado === 'crudo') cantidad += parseFloat(mov.cantidad) || 0;
                else if (mov.producto === productoId && mov.tipo === 'salida' && mov.estado === 'crudo') cantidad -= parseFloat(mov.cantidad) || 0;
            });
            return cantidad;
        }

        function calcularSaldoCocido(productoId) {
            const saldo = saldos.find(s => s.id === productoId);
            let cantidad = parseFloat(saldo?.cantidadCocida) || 0;
            movimientos.forEach(mov => {
                if (mov.producto === productoId && mov.tipo === 'entrada' && mov.estado === 'cocido') cantidad += parseFloat(mov.cantidad) || 0;
                else if (mov.producto === productoId && mov.tipo === 'salida' && mov.estado === 'cocido') cantidad -= parseFloat(mov.cantidad) || 0;
            });
            return cantidad;
        }

        function calcularSaldoActual(productoId) {
            const saldo = saldos.find(s => s.id === productoId);
            let cantidad = parseFloat(saldo?.cantidad) || 0;
            movimientos.forEach(mov => {
                if (mov.producto === productoId) {
                    if (mov.tipo === 'entrada') cantidad += parseFloat(mov.cantidad) || 0;
                    else cantidad -= parseFloat(mov.cantidad) || 0;
                }
            });
            return cantidad;
        }

        function actualizarEstadoEntrada() {
            const productoId = document.getElementById('producto-entrada').value;
            const saldo = saldos.find(s => s.id === productoId);
            const esProteina = saldo?.categoria?.includes('Prote√≠nas');
            document.getElementById('estado-entrada-grupo').style.display = esProteina ? 'block' : 'none';
        }

        function seleccionarEstadoEntrada(estado) {
            document.getElementById('estado-entrada').value = estado;
            document.querySelectorAll('#estado-entrada-grupo .estado-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }

        function registrarEntrada() {
            const proveedor = document.getElementById('proveedor-entrada').value;
            const producto = document.getElementById('producto-entrada').value;
            const cantidad = parseFloat(document.getElementById('cantidad-entrada').value);
            const costo = parseFloat(document.getElementById('costo-entrada').value);
            const responsable = document.getElementById('responsable-entrada').value;
            const saldo = saldos.find(s => s.id === producto);

            if (!proveedor || !producto || isNaN(cantidad) || isNaN(costo) || !responsable) {
                mostrarAlerta('‚ö†Ô∏è Completa campos', 'error');
                return;
            }

            const hoy = new Date().toISOString().split('T')[0];
            const ahora = new Date().toTimeString().slice(0, 5);
            const esProteina = saldo?.categoria?.includes('Prote√≠nas');
            const estado = esProteina ? document.getElementById('estado-entrada').value : '';

            let cantidadCruda = 0, cantidadCocida = 0;
            if (esProteina) {
                if (estado === 'crudo') cantidadCruda = cantidad;
                else cantidadCocida = cantidad;
            } else {
                cantidadCruda = cantidad;
            }

            movimientos.push({
                id: 'mov_' + Date.now(),
                tipo: 'entrada',
                proveedor,
                producto,
                cantidad,
                cantidadCruda,
                cantidadCocida,
                costo,
                totalCosto: cantidad * costo,
                estado,
                fecha: hoy,
                hora: ahora,
                responsable,
                timestamp: new Date().toISOString()
            });

            const ultimoMovimiento = movimientos[movimientos.length - 1];
            guardarDatos();
            enviarAGoogleSheets(ultimoMovimiento);
            mostrarAlerta('‚úÖ Registrada', 'success');
            limpiarFormEntrada();
            actualizarSaldos();
            actualizarListaEntradas();
        }

        function limpiarFormEntrada() {
            document.getElementById('producto-entrada').value = '';
            document.getElementById('cantidad-entrada').value = '';
            document.getElementById('costo-entrada').value = '';
        }

        function actualizarListaEntradas() {
            const lista = document.getElementById('lista-entradas');
            const ultimas = movimientos.filter(m => m.tipo === 'entrada').slice(-5).reverse();
            if (ultimas.length === 0) {
                lista.innerHTML = '<p style="color: #999;">Sin entradas</p>';
                return;
            }
            lista.innerHTML = ultimas.map(mov => {
                const saldo = saldos.find(s => s.id === mov.producto);
                return `<div class="area-saldos" style="padding: 8px; margin-bottom: 6px;"><div style="font-weight: 600; font-size: 11px;">${saldo?.nombre}</div><div style="font-size: 9px; color: #666;">${mov.cantidad} ${saldo?.unidad} | ${mov.estado || ''}</div></div>`;
            }).join('');
        }

        function actualizarEstadoSalida() {
            const productoId = document.getElementById('producto-salida').value;
            const saldo = saldos.find(s => s.id === productoId);
            const esProteina = saldo?.categoria?.includes('Prote√≠nas');
            document.getElementById('estado-salida-grupo').style.display = esProteina ? 'block' : 'none';
        }

        function seleccionarEstadoSalida(estado) {
            document.getElementById('estado-salida').value = estado;
            document.querySelectorAll('#estado-salida-grupo .estado-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }

        function registrarSalida() {
            const destino = document.getElementById('destino-salida').value;
            const producto = document.getElementById('producto-salida').value;
            const cantidad = parseFloat(document.getElementById('cantidad-salida').value);
            const responsable = document.getElementById('responsable-salida').value;
            const saldo = saldos.find(s => s.id === producto);

            if (!destino || !producto || isNaN(cantidad) || !responsable) {
                mostrarAlerta('‚ö†Ô∏è Completa campos', 'error');
                return;
            }

            const hoy = new Date().toISOString().split('T')[0];
            const ahora = new Date().toTimeString().slice(0, 5);
            const esProteina = saldo?.categoria?.includes('Prote√≠nas');
            const estado = esProteina ? document.getElementById('estado-salida').value : '';

            let saldoActual = 0;
            if (esProteina) {
                saldoActual = estado === 'crudo' ? calcularSaldoCrudo(producto) : calcularSaldoCocido(producto);
            } else {
                saldoActual = calcularSaldoActual(producto);
            }

            if (cantidad > saldoActual) {
                mostrarAlerta(`‚ö†Ô∏è Stock insuficiente: ${saldoActual}`, 'error');
                return;
            }

            let cantidadCruda = 0, cantidadCocida = 0;
            if (esProteina) {
                if (estado === 'crudo') cantidadCruda = cantidad;
                else cantidadCocida = cantidad;
            } else {
                cantidadCruda = cantidad;
            }

            movimientos.push({
                id: 'mov_' + Date.now(),
                tipo: 'salida',
                destino,
                producto,
                cantidad,
                cantidadCruda,
                cantidadCocida,
                estado,
                fecha: hoy,
                hora: ahora,
                responsable,
                timestamp: new Date().toISOString()
            });

            const ultimoMovimiento = movimientos[movimientos.length - 1];
            guardarDatos();
            enviarAGoogleSheets(ultimoMovimiento);
            mostrarAlerta('‚úÖ Registrada', 'success');
            limpiarFormSalida();
            actualizarSaldos();
            actualizarListaSalidas();
        }

        function limpiarFormSalida() {
            document.getElementById('producto-salida').value = '';
            document.getElementById('cantidad-salida').value = '';
        }

        function actualizarListaSalidas() {
            const lista = document.getElementById('lista-salidas');
            const ultimas = movimientos.filter(m => m.tipo === 'salida').slice(-5).reverse();
            if (ultimas.length === 0) {
                lista.innerHTML = '<p style="color: #999;">Sin salidas</p>';
                return;
            }
            const destinos = {'cocina': 'üë®‚Äçüç≥', 'barril': 'üçñ', 'caja': 'üí∞', 'consumo': 'ü•ò', 'merma': 'üìâ', 'danio': 'üî•'};
            lista.innerHTML = ultimas.map(mov => {
                const saldo = saldos.find(s => s.id === mov.producto);
                return `<div class="area-saldos" style="padding: 8px; margin-bottom: 6px;"><div style="font-weight: 600; font-size: 11px;">${saldo?.nombre}</div><div style="font-size: 9px; color: #666;">${destinos[mov.destino] || ''} ${mov.cantidad} ${saldo?.unidad}</div></div>`;
            }).join('');
        }

        function agregarResponsable() {
            const nombre = document.getElementById('nuevo-responsable').value.trim();
            if (!nombre || responsables.includes(nombre)) {
                mostrarAlerta('‚ö†Ô∏è Inv√°lido', 'error');
                return;
            }
            responsables.push(nombre);
            guardarDatos();
            document.getElementById('nuevo-responsable').value = '';
            actualizarListaResponsables();
            actualizarSelectos();
            mostrarAlerta('‚úÖ Agregado', 'success');
        }

        function actualizarListaResponsables() {
            const lista = document.getElementById('lista-responsables');
            lista.innerHTML = responsables.map(r => `<div class="area-saldos">üë§ ${r}</div>`).join('');
        }

        async function enviarAGoogleSheets(movimiento) {
            try {
                const saldo = saldos.find(s => s.id === movimiento.producto);
                const datos = {
                    action: 'addMovimiento',
                    fecha: movimiento.fecha,
                    producto: saldo?.nombre || '',
                    cantidad: movimiento.cantidad,
                    tipo: movimiento.tipo,
                    destino: movimiento.destino || '',
                    responsable: movimiento.responsable || ''
                };

                const response = await fetch(GOOGLE_SHEET_URL, {
                    method: 'POST',
                    body: JSON.stringify(datos),
                    mode: 'no-cors'
                });

                console.log('üì§ Movimiento enviado a Google');
            } catch(error) {
                console.error('‚ùå Error:', error);
            }
        }

        function actualizarReportes() {
            const desde = document.getElementById('fecha-desde').value;
            const hasta = document.getElementById('fecha-hasta').value;
            const movsFiltrados = movimientos.filter(m => m.fecha >= desde && m.fecha <= hasta);

            // STOCK
            const stockDiv = document.getElementById('tabla-stock-actual');
            let html = '<table class="tabla-reportes"><thead><tr><th>Producto</th><th>Stock</th></tr></thead><tbody>';
            saldos.forEach(s => {
                const total = s.categoria.includes('Prote√≠nas') ? 
                    (calcularSaldoCrudo(s.id) + calcularSaldoCocido(s.id)) : 
                    calcularSaldoActual(s.id);
                html += `<tr><td>${s.nombre}</td><td>${total.toFixed(2)} ${s.unidad}</td></tr>`;
            });
            html += '</tbody></table>';
            stockDiv.innerHTML = html;

            // MOVIMIENTOS
            const movsDiv = document.getElementById('tabla-movimientos');
            html = '<table class="tabla-reportes"><thead><tr><th>Fecha</th><th>Tipo</th><th>Producto</th><th>Cantidad</th></tr></thead><tbody>';
            movsFiltrados.forEach(mov => {
                const saldo = saldos.find(s => s.id === mov.producto);
                html += `<tr><td>${mov.fecha}</td><td>${mov.tipo === 'entrada' ? 'üì•' : 'üì§'}</td><td>${saldo?.nombre}</td><td>${mov.cantidad}</td></tr>`;
            });
            html += '</tbody></table>';
            movsDiv.innerHTML = html;
        }

        function actualizarSelectoCategorias() {
            const select = document.getElementById('saldo-categoria');
            if (select) {
                select.innerHTML = '<option value="">-- Selecciona --</option>' + Object.values(categorias).map(c => `<option value="${c}">${c}</option>`).join('');
            }
        }

        function actualizarSelectos() {
            const opcionesProductos = saldos.map(s => `<option value="${s.id}">${s.nombre}</option>`).join('');
            const opcionesProveedores = proveedores.map(p => `<option value="${p.id}">${p.nombre}</option>`).join('');
            const opcionesResponsables = responsables.map(r => `<option value="${r}">${r}</option>`).join('');

            document.getElementById('producto-entrada').innerHTML = '<option value="">-- Selecciona --</option>' + opcionesProductos;
            document.getElementById('producto-salida').innerHTML = '<option value="">-- Selecciona --</option>' + opcionesProductos;
            document.getElementById('proveedor-entrada').innerHTML = '<option value="">-- Selecciona --</option>' + opcionesProveedores;
            document.getElementById('responsable-entrada').innerHTML = '<option value="">-- Selecciona --</option>' + opcionesResponsables;
            document.getElementById('responsable-salida').innerHTML = '<option value="">-- Selecciona --</option>' + opcionesResponsables;
        }

        function mostrarAlerta(mensaje, tipo) {
            const alertaDiv = document.getElementById('alerta');
            alertaDiv.innerHTML = `<div class="alerta ${tipo}">${mensaje}</div>`;
            setTimeout(() => { alertaDiv.innerHTML = ''; }, 3000);
        }

        function cambiarTab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            event.target.classList.add('active');
            
            if (tab === 'reportes') actualizarReportes();
        }

        // MODALES PARA CREAR PRODUCTOS Y PROVEEDORES
        function mostrarModalNuevoProducto() {
            document.getElementById('nuevo-producto-nombre').value = '';
            document.getElementById('nuevo-producto-categoria').value = '';
            document.getElementById('nuevo-producto-minimo').value = '0';
            document.getElementById('modalNuevoProducto').classList.add('active');
        }

        function cerrarModalNuevoProducto() {
            document.getElementById('modalNuevoProducto').classList.remove('active');
        }

        function guardarProductoNuevo() {
            const nombre = document.getElementById('nuevo-producto-nombre').value.trim();
            const categoria = document.getElementById('nuevo-producto-categoria').value;
            const minimo = parseFloat(document.getElementById('nuevo-producto-minimo').value) || 0;

            if (!nombre || !categoria) {
                mostrarAlerta('‚ö†Ô∏è Completa nombre y categor√≠a', 'error');
                return;
            }

            const existeYa = saldos.find(s => s.nombre.toLowerCase() === nombre.toLowerCase());
            if (existeYa) {
                mostrarAlerta('‚ö†Ô∏è Este producto ya existe', 'error');
                return;
            }

            const nuevoSaldo = {
                id: 'saldo_nuevo_' + Date.now(),
                nombre: nombre,
                categoria: Object.values(categorias).find(c => c === categoria) || categoria,
                unidad: 'kg',
                stockMinimo: minimo,
                cantidadCruda: 0,
                cantidadCocida: 0,
                cantidad: 0,
                fechaCreacion: new Date().toISOString()
            };

            saldos.push(nuevoSaldo);
            guardarDatos();
            actualizarSelectos();
            actualizarSaldos();
            mostrarAlerta('‚úÖ Producto creado', 'success');
            cerrarModalNuevoProducto();
        }

        function mostrarModalNuevoProveedor() {
            document.getElementById('nuevo-proveedor-nombre').value = '';
            document.getElementById('nuevo-proveedor-telefono').value = '';
            document.getElementById('modalNuevoProveedor').classList.add('active');
        }

        function cerrarModalNuevoProveedor() {
            document.getElementById('modalNuevoProveedor').classList.remove('active');
        }

        function guardarProveedorNuevo() {
            const nombre = document.getElementById('nuevo-proveedor-nombre').value.trim();
            const telefono = document.getElementById('nuevo-proveedor-telefono').value.trim();

            if (!nombre) {
                mostrarAlerta('‚ö†Ô∏è Ingresa nombre', 'error');
                return;
            }

            const existeYa = proveedores.find(p => p.nombre.toLowerCase() === nombre.toLowerCase());
            if (existeYa) {
                mostrarAlerta('‚ö†Ô∏è Este proveedor ya existe', 'error');
                return;
            }

            const nuevoProveedor = {
                id: 'prov_nuevo_' + Date.now(),
                nombre: nombre,
                telefono: telefono
            };

            proveedores.push(nuevoProveedor);
            guardarDatos();
            actualizarSelectos();
            mostrarAlerta('‚úÖ Proveedor creado', 'success');
            cerrarModalNuevoProveedor();
        }

        window.addEventListener('load', inicializar);
    </script>
</body>
</html>
